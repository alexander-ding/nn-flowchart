{"version":3,"sources":["ModelInfo.js","Sidebar.js","Group.js","Line.js","Constants.js","Canvas.js","Toolbar.js","ErrorBox.js","SelectModel.js","LinkPage.js","SetInput.js","Utils.js","TrainSetup.js","Model.js","Data.js","App.js","Server.js","index.js"],"names":["activationBoxHeight","activationBoxColor","nodeTypes","dense","name","type","svg","props","activationSVG","circles","Object","toConsumableArray","Array","map","_","i","react_default","a","createElement","cx","xSize","cy","key","r","fill","activation","Fragment","width","height","y","offsetX","offsetY","defaultParameters","units","canActivation","shapeOut","parameters","shapeIn","setError","concat","slice","length","conv","xInterval","yInterval","x","squareSize","filters","kernelSize","stride","batchSize","dimensions","kernel","isArray","mapped","dimension","Math","floor","input","data","datasetID","inputShape","modelInfo","Number","maxpool","poolSize","embedding","isNumber","dropout","color","len","rate","flatten","reduce","total","value","output","outputShape","relu","d","stroke","strokeWidth","sigmoid","tanh","softmax","layerNames","activationNames","blankModel","JSON","parse","convModel","denseModel","SidebarHeader","className","tabSelected","onClick","changeTab","CTAList","href","Button","disabled","children","Layer","newModel","Activation","newActivation","EditElements","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","propsOri","setActivation","bind","assertThisInitialized","selected","models","update","_this2","Collapsible_default","trigger","triggerTagName","id","triggerClassName","triggerOpenedClassName","onOpen","onClose","open","layersCollapsed","activationsCollapsed","React","Component","TrainElements","propOri","isTraining","trainingInfo","trainButton","cancelTrain","trainCloud","setSelectModelPage","getLink","downloadModel","setInput","ElementsContainer","propsExtracted","Elements","Sidebar_EditElements","Sidebar","_React$Component2","_this3","state","set","inherits","createClass","v","setState","tab","Group","_React$Component","onMouseDown","e","model","handleDrag","clientX","clientY","ID","transform","String","style","userSelect","MarkerDefs","viewBox","refX","refY","markerWidth","markerHeight","orient","Line","strokeDasharray","tentative","pointerEvents","midX","x1","x2","midY","y1","y2","markerStart","markerMid","markerEnd","BASE_URL","BASE","DATASET_SHAPE","MNIST","IMDB","modelCenter","Canvas","isNewline","xOffset","yOffset","selectedLineFromTo","dragging","initX","initY","initModelX","initModelY","handleElementClick","trackMouse","handleBGClick","handleLineClick","deleteSelection","onMouseUp","dim","ReactDOM","findDOMNode","getBoundingClientRect","document","addEventListener","removeEventListener","editableSelected","keyCode","cancelNewline","select","remove","from","to","connectedTo","newX","newY","dragged","abs","target","refs","canvas","startNewline","idFrom","idTo","modelElements","entries","_ref","_ref2","slicedToArray","Group_Group","tentativeLine","coords","lines","_ref3","_ref4","index","otherModel","otherCoords","onMouseMove","ref","Padding","CanvasContainer","Canvas_Canvas","DisplayLine","EditableLine","valueChanged","currentValue","onFocus","setEditableSelected","onChange","onBlur","callback","paraName","event","oldValue","DataInput","setInputDataset","Parameters","Toolbar_EditableLine","n","Toolbar","loss","toFixed","accuracy","testAccuracy","progress","updateModelInfo","trainSetup","status","incomingShape","outgoingShape","ErrorBox","errorMsg","dismissible","data-dismiss","aria-label","aria-hidden","SelectModel","err","link","noChange","loadModel","toggle","display","loadDefaultModel","placeholder","LinkPage","dummy","body","appendChild","execCommand","removeChild","readOnly","SetInput","inputShapeDisplay","outputShapeDisplay","onChangeShapeInput","onChangeShapeOutput","onChangeName","onBlurInput","onBlurOutput","components","split","num","parseInt","isNaN","shape","join","breakShape","toString","loadDefaultInput","loadInput","isCyclic","visited","inRecursionStack","_i","_Object$keys","keys","_i2","_Object$keys2","isCyclicHelper","next","isLinear","numIncomingEdges","_i3","_Object$keys3","_i4","_Object$keys4","ok","_i5","_Object$keys5","isTrainable","resp","currentNode","Option","displayName","TrainSetup","step","learningRate","parseFloat","getElementById","min","optimizer","compileModel","layers","f","tf","inputLayer","conv1d","conv2d","maxPooling1d","maxPooling2d","getLayerF","para","stringify","inputDim","maxToken","outputDim","compileLayer","current_id","add","getModel","adam","sgd","rmsprop","getOptimizer","loss_fn","meanSquaredError","getLoss","compile","metrics","MnistData","_load","asyncToGenerator","regenerator_default","mark","_callee","img","ctx","imgRequest","labelsRequest","labelsResponse","wrap","_context","prev","Image","getContext","Promise","resolve","reject","crossOrigin","onload","naturalWidth","naturalHeight","datasetBytesBuffer","ArrayBuffer","NUM_DATASET_ELEMENTS","datasetBytesView","Float32Array","IMAGE_H","IMAGE_SIZE","drawImage","imageData","getImageData","j","datasetImages","src","fetch","all","sent","t0","Uint8Array","arrayBuffer","t1","datasetLabels","trainImages","testImages","trainLabels","NUM_CLASSES","testLabels","stop","apply","arguments","numTrainExapmles","xs","labels","numExamples","App","0","_model","1","epochs","nextID","errorOnce","currentEpoch","correct","batchesPerEpoch","selectModelPage","linkPage","settingInput","updateModel","selectModel","removeModel","startSession","endSession","updateTrain","_updateDependents","loadCustomInput","cloneDeep","random","inputNode","nextNode","oldModels","objectSpread","newModels","defineProperty","updateDependents","dict","canTuple","floatOkay","undefined","once","t","load","then","_data$getTrainData","getTrainData","_data$getTrainData2","ys","fit","callbacks","onBatchEnd","batch","logs","onTrainEnd","validationSplit","acc","stopTraining","_data$getTestData","getTestData","_data$getTestData2","evaluate","as1D","dataSync","response","json","Error","getIDFromLink","modelID","modelJSON","decoded","max","catch","message","_this4","serializedModel","method","headers","Accept","Content-Type","saveModel","responseJSON","_downloadModel","abrupt","save","url","_this5","datasetName","console","log","_this6","LinkPage_LinkPage","SelectModel_SelectModel","SetInput_SetInput","TrainSetup_TrainSetup","ErrorBox_ErrorBox","Sidebar_Sidebar","Toolbar_Toolbar","updateParameters","render","src_App_0"],"mappings":"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","file":"static/js/main.ac9b8c40.chunk.js","sourcesContent":["import React from 'react';\r\nimport { isArray, isNumber } from 'util';\r\n\r\n// mega fuckton of constants to describe the svg\r\n// shapes of things\r\n\r\n\r\n// describe layers' and activation function's svg representation\r\nconst activationBoxHeight = 20;\r\nconst activationBoxColor = \"#cccccc\";\r\n\r\nfunction conv(props) {\r\n  // svg for a conv layer\r\n  const squareSize = 40;\r\n  const xInterval = squareSize / 4;\r\n  const yInterval = squareSize / 4;\r\n\r\n  const firstColor = \"#2775f4\";\r\n  const secondColor = \"#4286f4\";\r\n  const thirdColor = \"#5c98f9\";\r\n  let activationSVG;\r\n  if (props.activation != null) {\r\n    activationSVG = nodeTypes[props.activation].svg(xInterval*2+squareSize/2, yInterval*2+squareSize+activationBoxHeight/2+3);\r\n  } else {\r\n    activationSVG = null\r\n  }\r\n  return <React.Fragment>\r\n    <rect width={squareSize} height={squareSize} fill={firstColor}/>\r\n    <rect x={xInterval} y={yInterval} width={squareSize} height={squareSize} fill={secondColor}/>\r\n    <rect x={xInterval*2} y={yInterval*2} width={squareSize} height={squareSize} fill={thirdColor}/>\r\n    <rect x={xInterval*2} y={yInterval*2+squareSize} width={squareSize} height={activationBoxHeight} fill={activationBoxColor}/>\r\n    {activationSVG}\r\n  </React.Fragment>\r\n}\r\n\r\nfunction dense(props) {\r\n  // svg for a dense layer\r\n  const xSize = 40;\r\n  const ySize = 80;\r\n  const numCircles = 3;\r\n  const squareColor = \"#665cf9\";\r\n  \r\n  const circleColor = \"#83a5f7\";\r\n\r\n  const circles = [...Array(numCircles)].map((_, i) =>\r\n    <circle cx={xSize / 2} \r\n            cy={(ySize-8) / numCircles * (i+0.5)+4} \r\n            key={i}\r\n            r={ySize / numCircles / 2 - 4}\r\n            fill={circleColor}>\r\n            \r\n            </circle>\r\n  );\r\n  let activationSVG;\r\n  if (props.activation != null) {\r\n    activationSVG = nodeTypes[props.activation].svg(xSize/2, ySize+activationBoxHeight/2+3);\r\n  } else {\r\n    activationSVG = null\r\n  }\r\n  return <React.Fragment>\r\n    <rect width={xSize} height={ySize} fill={squareColor}/>\r\n    <rect width={xSize} y={ySize} height={activationBoxHeight} fill={activationBoxColor}/>\r\n    {circles}\r\n    {activationSVG}\r\n  </React.Fragment>\r\n}\r\n\r\nfunction input(props) {\r\n  // svg for an input layer\r\n  const size = 30\r\n  const color = \"#99ccff\";\r\n  return <React.Fragment>\r\n    <rect width={size} height={size} fill={color}/>\r\n  </React.Fragment>\r\n}\r\n\r\nfunction output(props) {\r\n  // svg for an output layer\r\n  const color = \"#008066\";\r\n  const width = 30;\r\n  const height = 60;\r\n\r\n  let activationSVG;\r\n  if (props.activation != null) {\r\n    activationSVG = nodeTypes[props.activation].svg(width/2, height+activationBoxHeight/2+3);\r\n  } else {\r\n    activationSVG = null\r\n  }\r\n\r\n  return <React.Fragment>\r\n    <rect width={width} height={height} fill={color}></rect>\r\n    <rect width={width} y={height} height={activationBoxHeight} fill={activationBoxColor}></rect>\r\n    {activationSVG}\r\n  </React.Fragment>\r\n}\r\n\r\nfunction maxpool(props) {\r\n  // svg for a maxpool layer\r\n  const squareSize = 30;\r\n  const xInterval = squareSize / 4;\r\n  const yInterval = squareSize / 4;\r\n\r\n  const firstColor = \"#be41f4\";\r\n  const secondColor = \"#e541f4\";\r\n  const thirdColor = \"#f95cf9\";\r\n\r\n  return <React.Fragment>\r\n    <rect width={squareSize} height={squareSize} fill={firstColor}/>\r\n    <rect x={xInterval} y={yInterval} width={squareSize} height={squareSize} fill={secondColor}/>\r\n    <rect x={xInterval*2} y={yInterval*2} width={squareSize} height={squareSize} fill={thirdColor}/>\r\n  </React.Fragment>\r\n}\r\n\r\nfunction embedding(props) {\r\n  // svg for an embedding layer\r\n  const width = 20;\r\n  const height = 15;\r\n  const firstColor = \"#6a41f4\";\r\n  const secondColor = \"#8a61ff\";\r\n  const thirdColor = \"#7a51f5\";\r\n  return <React.Fragment>\r\n    <rect width={width*3} height={height} fill={firstColor}></rect>\r\n    <rect width={width*1.5} height={height} y={height} fill={secondColor}></rect>\r\n    <rect width={width*2.5} height={height} y={height*2} fill={thirdColor}></rect>\r\n  </React.Fragment>\r\n}\r\n\r\nfunction dropout(props) {\r\n  // svg for a dropout layer\r\n  const len = 10;\r\n  const color = \"#404040\";\r\n  return <React.Fragment>\r\n    <rect width={len} height={len} x={len*0} y={len*0} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*2} y={len*0} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*3} y={len*0} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*1} y={len*1} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*2} y={len*1} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*0} y={len*2} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*2} y={len*2} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*3} y={len*2} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*1} y={len*3} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*2} y={len*3} fill={color}></rect>\r\n    <rect width={len} height={len} x={len*3} y={len*3} fill={color}></rect>\r\n  </React.Fragment>\r\n}\r\n\r\nfunction flatten(props) {\r\n  // svg for a flatten layer\r\n  const width = 16;\r\n  const height = 120;\r\n  const color = \"#404040\";\r\n  return <React.Fragment>\r\n    <rect width={width} height={height} fill={color}></rect>\r\n  </React.Fragment>\r\n}\r\n\r\nfunction relu(x, y) {\r\n  // svg for a relu function\r\n  const width = 12;\r\n  const height = 8;\r\n  return <React.Fragment>\r\n    <path d={\"M\"+(x-width)+\" \"+y+\"l\"+width+ \" 0 l\" + width + \" -\" + height} stroke=\"black\" strokeWidth=\"2\" fill=\"none\"/>\r\n  </React.Fragment>\r\n}\r\n\r\nfunction sigmoid(x, y) {\r\n  // svg for a sigmoid function\r\n  const width = 12;\r\n  const height = 4;\r\n  return (\r\n    <path d={\"M \"+(x-width)+\" \"+y+\" q \"+(width-1)+ \" 0 \" + width + \" \" + (-height) + \" q 1 \" + (-height) + \" \" + width + \" \" + (-height)} stroke=\"black\" strokeWidth=\"2\" fill=\"none\"/>\r\n  )\r\n}\r\n\r\nfunction softmax(x, y) {\r\n  // svg for a softmax function\r\n  const width = 24;\r\n  const height = 8;\r\n  return (\r\n    <path d={\"M \"+(x-width/2)+\" \"+y+\" q \"+(width-1)+ \" 0 \" + width + \" \" + (-height)} stroke=\"black\" strokeWidth=\"2\" fill=\"none\"/>\r\n  )\r\n}\r\n\r\nfunction tanh(x, y) {\r\n  // svg for a tanh function\r\n  const width = 12;\r\n  const height = 4;\r\n  return (\r\n    <path d={\"M \"+(x-width)+\" \"+y+\" q \"+(width-5)+ \" 0 \" + width + \" \" + (-height) + \" q 5 \" + (-height) + \" \" + width + \" \" + (-height)} stroke=\"black\" strokeWidth=\"2\" fill=\"none\"/>\r\n  )\r\n}\r\n\r\n// this is a mapping from node type (layer or activation)\r\n// to its relevant constant information\r\n\r\n// name is its display name\r\n// type can be layer or activation\r\n// svg is its corresponding svg to be rendered\r\n// defaultParameters include its default parameters\r\n// canActivation indicates whether a layer can have an activation function\r\n// shapeOut is a functio nto calculate its output shape given its parameter and input shape\r\n\r\n// offsetX and offsetY for finding the center of the svg (from its corner)\r\n\r\nexport const nodeTypes = {\r\n    \"dense\": {\r\n        name: \"Dense\",\r\n        type: \"layer\",\r\n        svg: dense,\r\n        offsetX: 20, // offsets are for giving a point of contact for lines\r\n        offsetY: 50, \r\n        defaultParameters: {\r\n          units: 16,\r\n        },\r\n        canActivation: true,\r\n        // the function to compute the output shape given input shape and parameters\r\n        shapeOut: (parameters, shapeIn, setError) => {\r\n          if (shapeIn === null) {\r\n            return null;\r\n          }\r\n          return [...shapeIn.slice(0,shapeIn.length-1), parameters[\"units\"]];\r\n        },\r\n    },\r\n    \"conv\": {\r\n        name: \"Conv\",\r\n        type: \"layer\",\r\n        svg: conv,\r\n        offsetX: 40,\r\n        offsetY: 40,\r\n        defaultParameters: {\r\n          filters: 8,\r\n          kernelSize: [3,3], // could be both tuple or int. ndim needs to match with stride\r\n          stride: 1, // could be both tuple or int\r\n        },\r\n        canActivation: true,\r\n        shapeOut: (parameters, shapeIn, setError) => {\r\n          if (shapeIn === null) {\r\n            return null;\r\n          }\r\n          const batchSize = shapeIn[0];\r\n          const dimensions = shapeIn.slice(1, shapeIn.length-1);\r\n          const kernel = isArray(parameters[\"kernelSize\"]) ? parameters[\"kernelSize\"] : [parameters[\"kernelSize\"]];\r\n          \r\n          const stride = (typeof(parameters[\"stride\"]) === \"number\") ? Array(kernel.length).fill(parameters['stride']) : parameters[\"stride\"];\r\n          const filters = parameters[\"filters\"];\r\n          if (dimensions.length !== kernel.length) {\r\n            setError(\"Kernel must have the same ndim as the input dimension (without batchSize)\", false);\r\n            return null;\r\n          }\r\n          const mapped = dimensions.map((dimension, key) => {\r\n            return Math.floor((dimension - kernel[key])/stride[key])+1;\r\n          });\r\n          return [batchSize, ...mapped, filters];\r\n        },\r\n    },\r\n    \"input\": {\r\n      name: \"Input\",\r\n      type: \"layer\",\r\n      svg: input,\r\n      offsetX: 15,\r\n      offsetY: 15,\r\n      defaultParameters: {\r\n        data: \"MNIST\",\r\n        datasetID: \"\",\r\n        inputShape: [28, 28, 1],\r\n      },\r\n      canActivation: false,\r\n      shapeOut: (parameters, modelInfo, setError) => {\r\n        if (parameters['inputShape'] === null) {\r\n          return null;\r\n        }\r\n        if (isArray(parameters['inputShape'])) {\r\n          return [Number(modelInfo[\"batchSize\"]), ...parameters['inputShape']];\r\n        }\r\n        return [Number(modelInfo[\"batchSize\"]), parameters['inputShape']];\r\n      },\r\n    },\r\n    \"maxpool\": {\r\n      name: \"Max Pool\",\r\n      type: \"layer\",\r\n      svg: maxpool,\r\n      offsetX: 30,\r\n      offsetY: 30,\r\n      defaultParameters: {\r\n        poolSize: [2,2], // the length is dimensionality; can be between 1 to 3\r\n      },\r\n      canActivation: false,\r\n      shapeOut: (parameters, shapeIn, setError) => {\r\n        if (shapeIn === null) {\r\n          return null;\r\n        }\r\n        const batchSize = shapeIn[0];\r\n        const dimensions = shapeIn.slice(1,shapeIn.length-1);\r\n        const filters = shapeIn[shapeIn.length-1];\r\n        const poolSize = (typeof(parameters[\"poolSize\"]) === \"number\") ? [parameters[\"poolSize\"]] : parameters[\"poolSize\"];\r\n        \r\n        if (dimensions.length !== poolSize.length) {\r\n          setError(\"PoolSize must have the same ndim as the input dimension (without batchSize)\", false);\r\n          return null;\r\n        }\r\n        const mapped = dimensions.map((dimension, key) => {\r\n          return Math.floor((dimension)/poolSize[key]);\r\n        });\r\n        return [batchSize, ...mapped, filters];\r\n      }\r\n    },\r\n    \"embedding\": {\r\n      name: \"Embedding\",\r\n      type: \"layer\",\r\n      svg: embedding,\r\n      offsetX: 25,\r\n      offsetY: 20,\r\n      defaultParameters: {\r\n        units: 100,\r\n      },\r\n      canActivation: false,\r\n      shapeOut: (parameters, shapeIn, setError) => {\r\n        if (shapeIn === null) {\r\n          return null;\r\n        }\r\n        if (isNumber(shapeIn) || shapeIn.length !== 2) {\r\n          setError(\"Embedding input shape must be (batchSize, sequenceLength)\", false);\r\n          return null;\r\n        }\r\n        return [shapeIn[0], shapeIn[1], parameters['units']];\r\n      },\r\n    },\r\n    \"dropout\": {\r\n      name: \"Dropout\",\r\n      type: \"layer\",\r\n      svg: dropout,\r\n      offsetX: 20,\r\n      offsetY: 20,\r\n      defaultParameters: {\r\n        rate: 0.25,\r\n      },\r\n      canActivation: false,\r\n      shapeOut: (parameters, shapeIn, setError) => {\r\n        if (shapeIn === null) {\r\n          return null;\r\n        }\r\n        return shapeIn;\r\n      }\r\n    },\r\n    \"flatten\": {\r\n      name: \"Flatten\",\r\n      type: \"layer\",\r\n      svg: flatten,\r\n      offsetX: 8,\r\n      offsetY: 60,\r\n      defaultParameters: {},\r\n      canActivation: false,\r\n      shapeOut: (parameters, shapeIn, setError) => {\r\n        if (shapeIn === null) {\r\n          return null;\r\n        }\r\n        if (isNumber(shapeIn) || shapeIn.length <= 2) {\r\n          setError(\"Flatten input shape must be (batchSize, ...shape) (ndim > 2)\", false);\r\n          return null;\r\n        }\r\n        return [shapeIn[0], shapeIn.slice(1).reduce((total, value) => total*value)];\r\n      }\r\n    },\r\n    \"output\": {\r\n      name: \"Output\",\r\n      type: \"layer\",\r\n      svg: output,\r\n      offsetX: 10,\r\n      offsetY: 40,\r\n      defaultParameters: {\r\n        data: \"MNIST\",\r\n        outputShape: [10],\r\n      },\r\n      canActivation: true,\r\n      shapeOut: (parameters, shapeIn, setError) => {\r\n        if (shapeIn === null) {\r\n          return null;\r\n        }\r\n        if (isNumber(shapeIn) || shapeIn.length !== 2) {\r\n          setError(\"Output layer must have input layer of shape (batchSize, dim)\", false);\r\n        }\r\n        if (isArray(parameters['outputShape'])) {\r\n          return [...shapeIn.slice(0,shapeIn.length-1), ...parameters['outputShape']];\r\n        } else {\r\n          return [...shapeIn.slice(0,shapeIn.length-1), parameters['outputShape']];\r\n        }\r\n        \r\n      },\r\n    },\r\n    \"relu\": {\r\n      name: \"ReLU\",\r\n      type: \"activation\",\r\n      svg: relu,\r\n      defaultParameters: {}\r\n    },\r\n    \"sigmoid\": {\r\n      name: \"Sigmoid\",\r\n      type: \"activation\",\r\n      svg: sigmoid,\r\n      defaultParameters: {}\r\n    },\r\n    \"tanh\": {\r\n      name: \"Tanh\",\r\n      type: \"activation\",\r\n      svg: tanh,\r\n      defaultParameters: {}\r\n    },\r\n    \"softmax\": {\r\n      name: \"SoftMax\",\r\n      type: \"activation\",\r\n      svg: softmax,\r\n      defaultParameters: {}\r\n    }\r\n};\r\n\r\n// some more constants\r\nexport const layerNames = [\"dense\", \"conv\", \"maxpool\", \"flatten\", \"embedding\", \"dropout\"];\r\nexport const activationNames = [\"relu\", \"sigmoid\", \"softmax\", \"tanh\"];\r\n\r\n// preset models\r\n\r\nexport const blankModel = JSON.parse('{\"model\":{\"0\":{\"name\":\"input0\",\"ID\":0,\"type\":\"input\",\"x\":20,\"y\":50,\"connectedTo\":null,\"shapeIn\":[25,28,28,1],\"shapeOut\":[25,28,28,1],\"activation\":null,\"parameters\":{\"data\":\"MNIST\",\"datasetID\":\"\",\"inputShape\":[28,28,1]}},\"1\":{\"name\":\"output1\",\"ID\":1,\"type\":\"output\",\"x\":300,\"y\":50,\"connectedTo\":null,\"shapeIn\":null,\"shapeOut\":null,\"activation\":null,\"parameters\":{\"data\":\"MNIST\",\"outputShape\":[10]}}},\"modelInfo\":{\"epochs\":\"2\",\"batchSize\":\"25\",\"maxToken\":null,\"loss\":\"cce\",\"optimizer\":\"adam\",\"learningRate\":\"0.01\"}}');\r\n\r\nexport const convModel = JSON.parse(\"{\\\"model\\\":{\\\"0\\\":{\\\"name\\\":\\\"input0\\\",\\\"ID\\\":0,\\\"type\\\":\\\"input\\\",\\\"x\\\":20,\\\"y\\\":50,\\\"connectedTo\\\":4,\\\"shapeIn\\\":[25,28,28,1],\\\"shapeOut\\\":[25,28,28,1],\\\"activation\\\":null,\\\"parameters\\\":{\\\"data\\\":\\\"MNIST\\\",\\\"datasetID\\\":\\\"\\\",\\\"inputShape\\\":[28,28,1]}},\\\"1\\\":{\\\"name\\\":\\\"output1\\\",\\\"ID\\\":1,\\\"type\\\":\\\"output\\\",\\\"x\\\":300,\\\"y\\\":50,\\\"connectedTo\\\":null,\\\"shapeIn\\\":[25,288],\\\"shapeOut\\\":[25,10],\\\"activation\\\":\\\"softmax\\\",\\\"parameters\\\":{\\\"data\\\":\\\"MNIST\\\",\\\"outputShape\\\":[10]}},\\\"4\\\":{\\\"name\\\":\\\"conv4\\\",\\\"ID\\\":4,\\\"type\\\":\\\"conv\\\",\\\"x\\\":93.22129625745828,\\\"y\\\":45.02453806961887,\\\"connectedTo\\\":5,\\\"shapeIn\\\":[25,28,28,1],\\\"shapeOut\\\":[25,13,13,8],\\\"activation\\\":\\\"relu\\\",\\\"parameters\\\":{\\\"filters\\\":8,\\\"kernelSize\\\":[3,3],\\\"stride\\\":2}},\\\"5\\\":{\\\"name\\\":\\\"maxpool5\\\",\\\"ID\\\":5,\\\"type\\\":\\\"maxpool\\\",\\\"x\\\":164.94433122077317,\\\"y\\\":50.04710123987789,\\\"connectedTo\\\":6,\\\"shapeIn\\\":[25,13,13,8],\\\"shapeOut\\\":[25,6,6,8],\\\"activation\\\":null,\\\"parameters\\\":{\\\"poolSize\\\":[2,2]}},\\\"6\\\":{\\\"name\\\":\\\"flatten6\\\",\\\"ID\\\":6,\\\"type\\\":\\\"flatten\\\",\\\"x\\\":227.27825598586503,\\\"y\\\":17.505554649411522,\\\"connectedTo\\\":1,\\\"shapeIn\\\":[25,6,6,8],\\\"shapeOut\\\":[25,288],\\\"activation\\\":null,\\\"parameters\\\":{}}},\\\"modelInfo\\\":{\\\"epochs\\\":\\\"2\\\",\\\"batchSize\\\":\\\"25\\\",\\\"maxToken\\\":null,\\\"loss\\\":\\\"cce\\\",\\\"optimizer\\\":\\\"adam\\\",\\\"learningRate\\\":\\\"0.01\\\"}}\");\r\n\r\nexport const denseModel = JSON.parse(\"{\\\"model\\\":{\\\"0\\\":{\\\"name\\\":\\\"input0\\\",\\\"ID\\\":0,\\\"type\\\":\\\"input\\\",\\\"x\\\":18,\\\"y\\\":50,\\\"connectedTo\\\":5,\\\"shapeIn\\\":[25,28,28,1],\\\"shapeOut\\\":[25,28,28,1],\\\"activation\\\":null,\\\"parameters\\\":{\\\"data\\\":\\\"MNIST\\\",\\\"datasetID\\\":\\\"\\\",\\\"inputShape\\\":[28,28,1]}},\\\"1\\\":{\\\"name\\\":\\\"output1\\\",\\\"ID\\\":1,\\\"type\\\":\\\"output\\\",\\\"x\\\":288,\\\"y\\\":50,\\\"connectedTo\\\":null,\\\"shapeIn\\\":[25,128],\\\"shapeOut\\\":[25,10],\\\"activation\\\":\\\"softmax\\\",\\\"parameters\\\":{\\\"data\\\":\\\"MNIST\\\",\\\"outputShape\\\":[10]}},\\\"3\\\":{\\\"name\\\":\\\"flatten3\\\",\\\"ID\\\":3,\\\"type\\\":\\\"flatten\\\",\\\"x\\\":153.95333629131653,\\\"y\\\":24.011553705551506,\\\"connectedTo\\\":4,\\\"shapeIn\\\":[25,28,28,16],\\\"shapeOut\\\":[25,12544],\\\"activation\\\":null,\\\"parameters\\\":{}},\\\"4\\\":{\\\"name\\\":\\\"dense4\\\",\\\"ID\\\":4,\\\"type\\\":\\\"dense\\\",\\\"x\\\":207.20185248114421,\\\"y\\\":39.051709968596924,\\\"connectedTo\\\":1,\\\"shapeIn\\\":[25,12544],\\\"shapeOut\\\":[25,128],\\\"activation\\\":\\\"relu\\\",\\\"parameters\\\":{\\\"units\\\":128}},\\\"5\\\":{\\\"name\\\":\\\"dense5\\\",\\\"ID\\\":5,\\\"type\\\":\\\"dense\\\",\\\"x\\\":65.63926455425138,\\\"y\\\":26.941127293205966,\\\"connectedTo\\\":3,\\\"shapeIn\\\":[25,28,28,1],\\\"shapeOut\\\":[25,28,28,16],\\\"activation\\\":\\\"relu\\\",\\\"parameters\\\":{\\\"units\\\":16}}},\\\"modelInfo\\\":{\\\"epochs\\\":\\\"2\\\",\\\"batchSize\\\":\\\"25\\\",\\\"maxToken\\\":1000,\\\"loss\\\":\\\"cce\\\",\\\"optimizer\\\":\\\"sgd\\\",\\\"learningRate\\\":\\\"0.01\\\"}}\");","import React from 'react';\r\nimport Collapsible from 'react-collapsible';\r\nimport \"./Sidebar.css\";\r\nimport {nodeTypes, layerNames, activationNames} from \"./ModelInfo.js\";\r\n\r\nfunction SidebarHeader(props) {\r\n  /* the header (top left corner) of the sidebar */\r\n  const selectedClassName = \"btn btn-dark btn-block\";\r\n  const unselectedClassName = \"btn btn-outline-dark btn-block\";\r\n  return (\r\n    <div className=\"sidebar-header\">\r\n        <button type=\"button\" \r\n                className={props.tabSelected === \"edit\" ? selectedClassName : unselectedClassName }\r\n                onClick={() => props.changeTab(\"edit\")}>\r\n                Edit\r\n        </button>\r\n        <button type=\"button\" \r\n                className={props.tabSelected === \"train\" ? selectedClassName : unselectedClassName}\r\n                onClick={() => props.changeTab(\"train\")}>\r\n                Train\r\n        </button>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction CTAList() {\r\n  /* the credits on the bottom left corner */\r\n  return (\r\n    <ul className=\"list-unstyled CTAs\">\r\n      <li>\r\n        <a href=\"https://www.github.com/alexding123/NN-Flowchart\" className=\"download\">Download source</a>\r\n      </li>\r\n    </ul>\r\n  )\r\n}\r\n\r\nfunction Button(props) {\r\n  /* a button to be displayed on the sidebar */\r\n  return (\r\n    <div className=\"p-2 align-self-stretch button-container\">\r\n      <button className=\"btn btn-sm btn-dark btn-block\" onClick={props.onClick} disabled={props.disabled}>\r\n        {props.children}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Layer(props) {\r\n  /* returns a button to create a layer */\r\n  return (\r\n    <Button onClick={() => props.newModel(props.name)}>\r\n      {nodeTypes[props.name].name}\r\n    </Button>\r\n  )\r\n}\r\n\r\nfunction Activation(props) {\r\n  /* returns a button to append an activation */\r\n  return (\r\n    <Button onClick={() => props.newActivation(props.name)}>\r\n      {nodeTypes[props.name].name}\r\n    </Button>\r\n  );\r\n}\r\n\r\nclass EditElements extends React.Component {\r\n  /* the sidebar when it's under the edit bar */\r\n  constructor(props) {\r\n    super(props);\r\n    this.props = props;\r\n    this.propsOri = props.propsOri;\r\n    this.setActivation = this.setActivation.bind(this);\r\n  }\r\n\r\n  setActivation(name) {\r\n    /* set the selected model to a particular activation function */\r\n    // must have a layer selected\r\n    if (this.props.selected === -1) {\r\n      this.props.setError(\"Select a layer to add the activation to first!\", true);\r\n      return;\r\n    }\r\n    const selected = this.props.models[this.props.selected];\r\n\r\n    // cancel activation if model is not activation-capatible\r\n    if (!nodeTypes[selected.type].canActivation) {\r\n      return;\r\n    }\r\n    // cancel the existing activation if it's the same as this\r\n    if (selected.activation === name) {\r\n      this.props.update(this.props.selected, {\r\n        activation: null,\r\n      });\r\n    } else {\r\n      this.props.update(this.props.selected, {\r\n        activation: name,\r\n      });\r\n    }\r\n  }\r\n  \r\n  render() {\r\n    const triggerName = \"trigger\";\r\n    const triggerOpenName = \"trigger active\";\r\n    return <React.Fragment>\r\n      <Collapsible trigger=\"Layers\" triggerTagName=\"p\" id=\"layers-toggle\" triggerClassName={triggerName} triggerOpenedClassName={triggerOpenName} onOpen={() => this.propsOri.update(\"layers\", false)} onClose={() => this.propsOri.update(\"layers\", true)} open={!this.propsOri.layersCollapsed}>\r\n        <div className=\"d-flex flex-column\">\r\n        { layerNames.map((name) => \r\n          <Layer key={name}\r\n            name={name}\r\n            newModel={this.props.newModel}\r\n          />)\r\n        }\r\n        </div>\r\n      </Collapsible>\r\n      <Collapsible trigger=\"Activations\" triggerTagName=\"p\" triggerClassName={triggerName} triggerOpenedClassName={triggerOpenName} onOpen={() => this.propsOri.update(\"activations\", false)} onClose={() => this.propsOri.update(\"activations\", true)} open={!this.propsOri.activationsCollapsed}>\r\n      <div className=\"d-flex flex-column\">\r\n      { activationNames.map((name) => \r\n        <Activation key={name} \r\n          name={name} \r\n          newActivation={() => this.setActivation(name)}\r\n        />\r\n        )\r\n      }\r\n      </div>\r\n      </Collapsible>\r\n    </React.Fragment>\r\n  }\r\n}\r\n\r\nfunction TrainElements(propOri) {\r\n  /* the display of the sidebar when it is under the train tab */\r\n  const props = propOri.props;\r\n  const isTraining = props.trainingInfo[\"status\"] !== \"Edit\";\r\n\r\n  // train if not training, cancel button if training\r\n  const trainButton = (!isTraining) ? \r\n                 <Button onClick={props.trainCloud}>Train on Cloud</Button> : \r\n                 <Button onClick={props.cancelTrain}>Cancel</Button>;\r\n  return (\r\n    <React.Fragment>\r\n      <p>Server</p>\r\n      <Button onClick={props.setSelectModelPage} disabled={isTraining}>New/Load</Button>\r\n      <Button onClick={props.getLink}>Generate Link</Button>\r\n      \r\n      <p>Model</p>\r\n      {trainButton}\r\n      <Button onClick={props.downloadModel}>Download Model</Button>\r\n\r\n      <p>Input</p>\r\n      <Button onClick={props.setInput}>Set Input</Button>\r\n      \r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nfunction ElementsContainer(props) {\r\n  /* the container of a list of buttons */\r\n  const propsExtracted = props.props;\r\n  const Elements = props.tabSelected === \"edit\" ? <EditElements propsOri={props} models={propsExtracted.models} selected={propsExtracted.selected} setError={propsExtracted.setError} newModel={propsExtracted.newModel} update={propsExtracted.update}/>: <TrainElements props={propsExtracted}/>;\r\n  return (\r\n    <ul className=\"list-unstyled components\">\r\n      {Elements}\r\n    </ul>\r\n  )\r\n}\r\n\r\nexport class Sidebar extends React.Component {\r\n  /* the master sidebar to the left */\r\n  constructor(props) {\r\n    super(props);\r\n    this.props = props\r\n    this.state = {\r\n      tabSelected: \"edit\", // which tab is selected\r\n      layersCollapsed: false, // whether the accordion tab is collapsed\r\n      activationsCollapsed: false,\r\n    };\r\n    this.changeTab = this.changeTab.bind(this);\r\n    this.set = this.set.bind(this);\r\n  }\r\n\r\n  set(name, v) {\r\n    /* set whether the tab is collapsed */\r\n    if (name === \"layers\") {\r\n      this.setState({layersCollapsed: v});\r\n    } else if (name === \"activations\") {\r\n      this.setState({activationsCollapsed: v});\r\n    }\r\n  }\r\n\r\n  changeTab(tab) {\r\n    /* updates the current tab selected */\r\n    this.setState({\r\n      tabSelected: tab\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <nav className=\"p-2 h-100\" id=\"sidebar\">\r\n        <SidebarHeader tabSelected={this.state.tabSelected} changeTab={this.changeTab} />\r\n        <ElementsContainer tabSelected={this.state.tabSelected} layersCollapsed={this.state.layersCollapsed} activationsCollapsed={this.state.activationsCollapsed} update={this.set} props={this.props}/>\r\n        <CTAList />\r\n      \r\n      </nav>\r\n    )\r\n  }\r\n  \r\n}","import React from 'react';\r\nimport {nodeTypes} from \"./ModelInfo.js\";\r\n\r\nexport class Group extends React.Component {\r\n  /* a class for one single model's svg */\r\n  constructor(props) {\r\n    super(props);\r\n    this.props = props;\r\n    this.onMouseDown = this.onMouseDown.bind(this);\r\n  }\r\n  \r\n  \r\n  onMouseDown(e) {\r\n    /* start a drag-n-drop when clicked */\r\n    const model = this.props.model;\r\n    this.props.handleDrag(e.clientX, e.clientY, model.ID);\r\n  }\r\n  \r\n  \r\n  render() {\r\n    const model = this.props.model;\r\n\r\n    return (\r\n      <g className={this.props.selected ? \"selected\" : \"\"}\r\n        onMouseDown={this.onMouseDown}\r\n        key={model.ID} \r\n        transform={\"translate(\" + String(model.x) + \",\" + String(model.y) + \")\"}\r\n        style={{userSelect: 'none'}} // to prevent selecting\r\n      >\r\n      {nodeTypes[model.type].svg(model)}\r\n      </g>\r\n    )\r\n  }\r\n  \r\n}","import React from 'react';\r\n\r\nexport function MarkerDefs(props) {\r\n  /* defines the marker for the lines drawn in the svg */\r\n  // arrowed line\r\n  return (\r\n    <defs>\r\n      <marker id=\"dot\" viewBox=\"0 0 10 10\" refX=\"5\" refY=\"5\"\r\n        markerWidth=\"5\" markerHeight=\"5\">\r\n        <circle cx=\"5\" cy=\"5\" r=\"3\" fill=\"black\" />\r\n      </marker>\r\n      <marker id=\"arrow\" markerWidth=\"4\" markerHeight=\"4\"\r\n      orient=\"auto\" refY=\"2\">\r\n        <path d=\"M0,0 L4,2 0,4\"/>\r\n      </marker>\r\n    </defs>\r\n  )\r\n  }\r\n  \r\nexport function Line(props) {\r\n  /* defines an actual svg line, with arrows and dotted\r\n   * if selected\r\n   */\r\n    const strokeDasharray = props.tentative ? \"5,5\" : null;\r\n    const className = props.selected ? \"selected\" : null;\r\n    const onClick = props.tentative ? null : props.onClick;\r\n    let pointerEvents = props.tentative ? \"none\" : null;\r\n    if (\"pointerEvents\" in props) {\r\n      pointerEvents = props.pointerEvents;\r\n    }\r\n    const midX = (props.x1+props.x2) / 2;\r\n    const midY = (props.y1+props.y2) / 2;\r\n    return (\r\n    <path d={\"M \"+props.x1+\" \"+props.y1+\r\n             \" L \"+midX+\" \"+midY+\r\n             \" L \"+props.x2+\" \"+props.y2}\r\n          onClick={onClick}\r\n          className={className}\r\n          pointerEvents={pointerEvents}\r\n          strokeDasharray={strokeDasharray} \r\n          stroke=\"black\" \r\n          strokeWidth=\"3\"\r\n          markerStart=\"url(#arrow)\"\r\n          markerMid=\"url(#arrow)\"\r\n          markerEnd=\"url(#dot)\"/>\r\n    );\r\n  }\r\n  ","export const DELETE_KEY = 8; // keycode\r\nexport const BASE = \"https://nn-flowchart.herokuapp.com/\";\r\nexport const BASE_URL = BASE + \"api/\"; \r\n\r\nexport const DATASET_SHAPE = {\r\n    \"MNIST\": {\r\n        \"input\": [28, 28, 1],\r\n        \"output\": [10],\r\n    },\r\n    \"IMDB\": {\r\n        \"input\": [500],\r\n        \"output\": [2],\r\n    }\r\n}","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport \"./Canvas.css\";\r\nimport {nodeTypes} from \"./ModelInfo.js\";\r\nimport {Group} from \"./Group.js\";\r\nimport {MarkerDefs, Line} from \"./Line.js\";\r\nimport {DELETE_KEY} from \"./Constants.js\";\r\n\r\n\r\nfunction modelCenter(model) {\r\n  /* get coordinates for the point on a model to connect to\r\n   */\r\n  const offsetX = nodeTypes[model.type].offsetX\r\n  const offsetY = nodeTypes[model.type].offsetY\r\n  return {x: model.x+offsetX, y: model.y+offsetY}\r\n}\r\n\r\nclass Canvas extends React.Component {\r\n  /* the class implementing the actual svg and all the event\r\n   * listerers (along with its downstream elements)\r\n   * stores the mouse locations and such information to implement\r\n   * drag and drop\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.props = props;\r\n    \r\n    this.state = {\r\n      isNewline: false, // is there a new line being constructed?\r\n      xOffset: 0, // offset of the svg's x from clientX\r\n      yOffset: 0, // ibid for y\r\n      x: 0, // x of the mouse relative to the svg\r\n      y: 0, // ibid for y\r\n      id: -1, // id of the line from which the current new line stems from\r\n      selectedLineFromTo: [-1,-1], // selected line from node X to node Y ([X,Y])\r\n      dragging: -1, // -1 means no dragging\r\n      initX: 0,\r\n      initY: 0,\r\n      initModelX: 0,\r\n      initModelY: 0,\r\n    }\r\n\r\n    // some function bindings\r\n    this.handleElementClick = this.handleElementClick.bind(this);\r\n    this.trackMouse = this.trackMouse.bind(this);\r\n    this.handleBGClick = this.handleBGClick.bind(this);\r\n    this.handleLineClick = this.handleLineClick.bind(this);\r\n    this.deleteSelection = this.deleteSelection.bind(this);\r\n    this.handleDrag = this.handleDrag.bind(this);\r\n    this.onMouseUp = this.onMouseUp.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    // finds out the offsets of the svg\r\n    const dim = ReactDOM.findDOMNode(this).getBoundingClientRect();\r\n    this.setState({\r\n      xOffset: dim.x,\r\n      yOffset: dim.y,\r\n    });\r\n\r\n    // setup key listener for deletion\r\n    document.addEventListener(\"keydown\", this.deleteSelection);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    // reset\r\n    document.removeEventListener(\"keydown\", this.deleteSelection);\r\n  }\r\n\r\n  deleteSelection(e) {\r\n    /* delete the selected model */\r\n    // ignore delete if editing a parameter\r\n    if (this.props.editableSelected) {\r\n      return;\r\n    }\r\n    if (e.keyCode === DELETE_KEY) {\r\n      // prioritize items over line\r\n      // if an item is selected\r\n      if (this.props.selected !== -1) {\r\n        // first cancel a few things just in case (to prevent errors)\r\n        this.cancelNewline();\r\n        const selected = this.props.selected;\r\n        \r\n        // cannot delete input or output node\r\n        if (selected === 0 || selected === 1) {\r\n          return;\r\n        }\r\n        this.props.select(-1);\r\n\r\n        this.props.remove(selected);\r\n        return;\r\n      }\r\n\r\n      // delete selected line\r\n      const from = this.state.selectedLineFromTo[0];\r\n      const to = this.state.selectedLineFromTo[1];\r\n      if (from !== -1 || to !== -1) {\r\n        this.cancelNewline();\r\n        this.props.update(from, {\r\n          connectedTo: null,\r\n        });\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  startNewline(id) {\r\n    /* starts the construction of a tentative new line */\r\n\r\n    this.setState( {\r\n      isNewline: true,\r\n      id: id,\r\n      selectedLineFromTo: [-1, -1], // reset line selection\r\n    });\r\n  }\r\n\r\n  cancelNewline() {\r\n    /* cancels the tentative new line */\r\n    this.setState({\r\n      isNewline: false,\r\n      id: -1,\r\n      selectedLineFromTo: [-1, -1], // reset line selection\r\n    })\r\n  }\r\n\r\n  trackMouse(e) {\r\n    /* a helper function to keep tracking mouse movement */\r\n    this.setState({\r\n      x: e.clientX - this.state.xOffset,\r\n      y: e.clientY - this.state.yOffset,\r\n    });\r\n\r\n    if (this.state.dragging !== -1) {\r\n      const newX = e.clientX + this.state.initModelX - this.state.initX;\r\n      const newY = e.clientY + this.state.initModelY - this.state.initY;\r\n      this.props.update(this.state.dragging, {\r\n        x: newX,\r\n        y: newY,\r\n      });\r\n    }\r\n  }\r\n\r\n  onMouseUp(e) {\r\n    /* when the click is released, stop the drag-n-drop\r\n     * and decide if it's an actual click\r\n     */\r\n    \r\n    if (this.state.dragging === -1) {\r\n      return;\r\n    }\r\n    const dragging = this.state.dragging;\r\n    const dragged = this.props.models[dragging];\r\n\r\n    // reset drag\r\n    this.setState({\r\n      dragging: -1,\r\n    });\r\n    \r\n    const threshold = 10;\r\n    // if movement is small enough, consider it a click\r\n    if (Math.abs(dragged.x - this.state.initModelX) + Math.abs(dragged.y - this.state.initModelY) < threshold) {\r\n      this.props.select(dragged.ID);\r\n      this.handleElementClick(dragged.ID);\r\n    }\r\n  }\r\n\r\n  handleBGClick(e) {\r\n    /* handles a click on the background */\r\n    if (e.target === this.refs.canvas) {\r\n      this.props.select(-1); // deselect elements\r\n      this.cancelNewline();\r\n      return;\r\n    }\r\n    // the rest is handled on handleElementClick\r\n  }\r\n\r\n  handleElementClick(id) {\r\n    /* handles a click to one of the elemnts, to be passed\r\n     * to the child classes of the canvas\r\n     */\r\n    // if this is a new line, clicked on another object\r\n    if (this.state.isNewline) {\r\n\r\n      // if the line is drawn to itself, ignore\r\n      if (this.state.id !== id) {\r\n        // update model so that new connection is made\r\n        this.props.update(this.state.id, {\r\n          connectedTo: id,\r\n        });\r\n        \r\n        // if the reverse connection exists, cancel it\r\n        if (this.props.models[id].connectedTo === this.state.id) {\r\n          this.props.update(id, {\r\n            connectedTo: null,\r\n          })\r\n        }\r\n      }\r\n      // remove temporary line\r\n      this.cancelNewline();\r\n      return;\r\n    }\r\n    // if no current line, start one\r\n    this.startNewline(id);\r\n  }\r\n\r\n  handleLineClick(idFrom, idTo) {\r\n    /* handles a click on the line, to be passed\r\n     * to the child class\r\n     */\r\n    this.setState({\r\n      selectedLineFromTo: [idFrom, idTo]\r\n    })\r\n    this.props.select(-1);\r\n  }\r\n\r\n  handleDrag(initX, initY, id) {\r\n    /* handle a new dragging session */\r\n    const model = this.props.models[id];\r\n    this.setState({\r\n      dragging: id,\r\n      initX: initX,\r\n      initY: initY,\r\n      initModelX: model.x,\r\n      initModelY: model.y\r\n    });\r\n    this.props.select(model.ID);\r\n  }\r\n\r\n  render() {\r\n    // let's do all the layers from the model first\r\n    const modelElements = Object.entries(this.props.models).map(([key, model]) => {\r\n\r\n    \r\n      return <Group key={model.ID} handleDrag={this.handleDrag} model={model} selected={this.props.selected===model.ID}/>;\r\n    });\r\n    \r\n    // this part handles rendering the tentative line (if any)\r\n    let tentativeLine = null;\r\n    if (this.state.isNewline) {\r\n      const coords = modelCenter(this.props.models[this.state.id]);\r\n      tentativeLine = <Line tentative={true} selected={true} x1={coords.x} y1={coords.y} x2={this.state.x} y2={this.state.y}/>\r\n    }\r\n\r\n    // renders all the lines between models\r\n    const lines = Object.entries(this.props.models).map(([index, model]) => {\r\n      // no line if there is no connection\r\n      if (model.connectedTo === null) {\r\n        return null;\r\n      }\r\n      const otherModel = this.props.models[model.connectedTo];\r\n      const coords = modelCenter(model);\r\n      const otherCoords = modelCenter(otherModel);\r\n      const selected = this.state.selectedLineFromTo[0]===model.ID && this.state.selectedLineFromTo[1] === otherModel.ID;\r\n\r\n      return <Line key={index} tentative={false} selected={selected} x1={coords.x} y1={coords.y} x2={otherCoords.x} y2={otherCoords.y} onClick={() => this.handleLineClick(model.ID, otherModel.ID)}></Line>\r\n    })\r\n\r\n    \r\n    return (\r\n      // stick a rect for background\r\n      <svg onClick={this.handleBGClick} onMouseMove={this.trackMouse} onMouseUp={this.onMouseUp} id=\"canvas\" width=\"100%\" height=\"60%\" ref=\"canvas\">\r\n        <MarkerDefs/>\r\n        <rect width=\"100%\" height=\"100%\" fill=\"#b477ec\" pointerEvents=\"none\"/>\r\n        {modelElements}\r\n        {lines}\r\n        {tentativeLine}\r\n      </svg>\r\n    )\r\n  }\r\n  \r\n}\r\n\r\nfunction Padding(props) {\r\n  /* just padding to make the main canvas look better */\r\n  return (\r\n    <svg width=\"100%\" height=\"20%\">\r\n      <rect width=\"100%\" height=\"100%\" fill=\"blueviolet\"/>\r\n    </svg>\r\n  )\r\n}\r\n\r\nexport function CanvasContainer(props) {\r\n  /* contains the main section of the page yay */\r\n  return (\r\n    // padding on top and below to look extra good\r\n    <div className=\"p-2 flex-grow-1 canvas-container no-margin\"> \r\n      <Padding/>\r\n      <Canvas models={props.models} editableSelected={props.editableSelected} selected={props.selected} select={props.select} update={props.update} remove={props.remove}/>\r\n      <Padding/>\r\n    </div>\r\n  );\r\n}","import React from \"react\";\r\nimport \"./Toolbar.css\";\r\nimport {nodeTypes} from \"./ModelInfo.js\";\r\n\r\nfunction DisplayLine(props) {\r\n  /* Returns a line of view-only parameter */\r\n  return (\r\n    <div className=\"parameter-line\">\r\n      <div className=\"parameter-name\">{props.name}:</div>\r\n      <div className=\"parameter-value\">{props.value}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nclass EditableLine extends React.Component {\r\n  /* a line of parameters that is editable */\r\n  constructor(props) {\r\n    super(props);\r\n    this.props = props;\r\n    this.state = {\r\n      valueChanged: false,\r\n      currentValue: null,\r\n    };\r\n    // handles: \r\n    // onFocus -- reports to parent that editable is selected\r\n    // onChange -- updates and stores internal value\r\n    // onBlur -- callbacks to update the model and reset the internal state\r\n    this.onFocus = () => this.props.setEditableSelected(true);\r\n    this.onChange = this.onChange.bind(this);\r\n    this.onBlur = (value) => {\r\n      this.setState({\r\n        valueChanged: false,\r\n        currentValue: null,\r\n      });\r\n      this.props.setEditableSelected(false);\r\n      this.props.callback(this.props.paraName, value);\r\n    };\r\n  }\r\n\r\n  onChange(event) {\r\n    /* update the value of the parameter when changed */\r\n    const value = event.target.value;\r\n\r\n    this.setState({\r\n      valueChanged: true,\r\n      currentValue: value,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const oldValue = this.props.parameters[this.props.paraName];\r\n    // display oldValue if no value is changed\r\n    const value = (this.state.valueChanged ? this.state.currentValue : oldValue);\r\n\r\n    return (\r\n      <div className=\"parameter-line\">\r\n        <div className=\"parameter-name\">{this.props.name}</div>\r\n        <input className=\"parameter-input\" onFocus={this.onFocus} onBlur={() => this.onBlur(value)} onChange={this.onChange} value={value}></input>\r\n      </div>\r\n    )\r\n  } \r\n}\r\n\r\nfunction DataInput(props) {\r\n  /* the line allowing setting of dataset */\r\n  return (\r\n    <div className=\"parameter-line\">\r\n      <div className=\"parameter-name\">Dataset</div>\r\n      <div className=\"parameter-input parameter-clickable\" onClick={props.setInputDataset}>{props.value}</div>\r\n      \r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Parameters(props) {\r\n  /* Returns a list of lines of editable parameters */\r\n  const model = props.model;\r\n  if (model === null) {\r\n    return null;\r\n  }\r\n\r\n  // differs depending on model type\r\n  switch (model.type) {\r\n    case \"dense\":\r\n      return (\r\n        <React.Fragment>\r\n          <EditableLine name=\"Units\" paraName=\"units\" setEditableSelected={props.setEditableSelected} parameters={model.parameters} callback={(n,v)=>props.callback(n,v,false)}/>\r\n        </React.Fragment>\r\n      );\r\n    case \"conv\":\r\n      return (\r\n        <React.Fragment>\r\n          <EditableLine name=\"Filters\" paraName=\"filters\" setEditableSelected={props.setEditableSelected} parameters={model.parameters} callback={(n,v)=>props.callback(n,v,false)}/>\r\n          <EditableLine name=\"Kernel Size\" paraName=\"kernelSize\" setEditableSelected={props.setEditableSelected} parameters={model.parameters} callback={(n,v)=>props.callback(n,v,true)}/>\r\n          <EditableLine name=\"Stride\" paraName=\"stride\" setEditableSelected={props.setEditableSelected} parameters={model.parameters} callback={(n,v)=>props.callback(n,v,true)}/>\r\n        </React.Fragment>\r\n      )\r\n    case \"input\":\r\n      return (\r\n        <React.Fragment>\r\n          <DataInput value={model.parameters.data} setInputDataset={props.setInputDataset}></DataInput>\r\n        </React.Fragment>\r\n      )\r\n    case \"maxpool\":\r\n      return (\r\n        <React.Fragment>\r\n          <EditableLine name=\"Pool Size\" paraName=\"poolSize\" setEditableSelected={props.setEditableSelected} parameters={model.parameters} callback={(n,v)=>props.callback(n,v,true)}/>\r\n        </React.Fragment>\r\n      )\r\n    case \"embedding\":\r\n      return (\r\n        <React.Fragment>\r\n          <EditableLine name=\"Units\" paraName=\"units\" setEditableSelected={props.setEditableSelected} parameters={model.parameters} callback={(n,v)=>props.callback(n,v,false)}/>\r\n        </React.Fragment>\r\n      )\r\n    case \"dropout\":\r\n      return (\r\n        <React.Fragment>\r\n          <EditableLine name=\"Rate\" paraName=\"rate\" setEditableSelected={props.setEditableSelected} parameters={model.parameters} callback={(n,v)=>props.callback(n,v,false,true)}/>\r\n        </React.Fragment>\r\n      )\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n\r\nexport function Toolbar(props) {\r\n  /* the master toolbar to the bottom */\r\n\r\n  // if no model is selected, show training information\r\n  if (props.selected === -1) {\r\n    const modelInfo = props.modelInfo;\r\n    const trainingInfo = props.trainingInfo;\r\n    const loss = (trainingInfo.loss === null) ? \"N/A\" : trainingInfo.loss.toFixed(2);\r\n    const accuracy = (trainingInfo.accuracy === null) ? \"N/A\" : (trainingInfo.accuracy*100).toFixed(2) + \"%\";\r\n    const testAccuracy = (trainingInfo.testAccuracy === null) ? \"N/A\" : (trainingInfo.testAccuracy*100).toFixed(2) + \"%\";\r\n    const progress = (trainingInfo.progress === null) ? \"0.0%\" : (trainingInfo.progress*100).toFixed(2) + \"%\";\r\n    return (\r\n      <nav className=\"p-2 no-margin\" id=\"toolbar\">\r\n        <div id=\"toolbar-container\">\r\n          <div className=\"left-line\">\r\n            <p>Model Information</p>\r\n            <EditableLine name=\"Epochs\" paraName=\"epochs\" setEditableSelected={()=>null} parameters={modelInfo} callback={(n,v) => props.updateModelInfo(n,v,true)}/>\r\n            <EditableLine name=\"Batch Size\" paraName=\"batchSize\" setEditableSelected={()=>null} parameters={modelInfo} callback={(n,v) => props.updateModelInfo(n,v,true)}/>\r\n            <button onClick={props.trainSetup} className=\"btn btn-sm btn-light btn-block\">More</button>\r\n          </div>\r\n          <div className=\"blocker\"></div>\r\n          <div className=\"middle-line\">\r\n            <p>Train Information</p>\r\n            <DisplayLine name=\"Status\" value={trainingInfo.status}/>\r\n            <DisplayLine name=\"Progress\" value={progress}/>\r\n          </div>\r\n          <div className=\"blocker\"></div>\r\n          <div className=\"right-line\">\r\n            <br></br>\r\n            <DisplayLine name=\"Accuracy\" value={accuracy}/>\r\n            <DisplayLine name=\"Loss\" value={loss}/>\r\n            <DisplayLine name=\"Test Acc\" value={testAccuracy}/>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n    )\r\n  }\r\n\r\n  // if a model is selected...\r\n  // show the model's parameters page\r\n  const model = props.models[props.selected];\r\n\r\n  const type = nodeTypes[model.type].name;\r\n  const activation = (model.activation === null) ? \"None\" : nodeTypes[model.activation].name;\r\n  const incomingShape = (model.shapeIn === null ? \"N/A\" : String(model.shapeIn));\r\n  const outgoingShape = (model.shapeOut === null ? \"N/A\" : String(model.shapeOut));\r\n  return (\r\n    <nav className=\"p-2 no-margin\" id=\"toolbar\">\r\n      <div id=\"toolbar-container\">\r\n        \r\n        <div className=\"left-line\">\r\n          <p>Parameters</p>\r\n          <Parameters model={model} callback={props.update} setEditableSelected={props.setEditableSelected} setInputDataset = {props.setInputDataset}/>\r\n        </div>\r\n        <div className=\"blocker\"></div>\r\n        <div className=\"middle-line\">\r\n          <p>Layer Information</p>\r\n          <DisplayLine name=\"Type\" value={type}/>\r\n          <DisplayLine name=\"Activation\" value={activation}/>\r\n        </div>\r\n        <div className=\"blocker\"></div>\r\n        <div className=\"right-line\">\r\n          <br></br>\r\n          <DisplayLine name=\"Shape In\" value={incomingShape}/>\r\n          <DisplayLine name=\"Shape Out\" value={outgoingShape}/>\r\n        </div>\r\n      </div>\r\n    </nav>\r\n  )\r\n}","import React from 'react';\r\nimport \"./ErrorBox.css\";\r\n\r\nexport function ErrorBox(props) {\r\n  /* Renders a dismissable error message */\r\n  // display nothing if no error message\r\n  if (props.errorMsg === null) {\r\n    return null;\r\n  }\r\n  if (props.dismissible) {\r\n    return (\r\n      <div className=\"position-absolute float-box\">\r\n        <div className=\"alert alert-danger alert-dismissible position-absolute w-100\">\r\n          <strong>Error:</strong> {props.errorMsg}\r\n          <button type=\"button\" className=\"close\" data-dismiss=\"alert\" aria-label=\"Close\" \r\n                  onClick={() => props.setError(null, true)}>\r\n            <span aria-hidden=\"true\">&times;</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n  return (\r\n    <div className=\"position-absolute float-box\">\r\n      <div className=\"alert alert-danger position-absolute w-100\">\r\n        <strong>Error:</strong> {props.errorMsg}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import React from 'react';\r\nimport \"./SelectModel.css\";\r\n\r\nexport class SelectModel extends React.Component {\r\n  /* the page selecting a model */\r\n  constructor(props) {\r\n    super(props);\r\n    this.props = props;\r\n    this.state = {\r\n      err: null,\r\n      link: null,\r\n    }\r\n\r\n    this.onChange = this.onChange.bind(this);\r\n    this.noChange = this.noChange.bind(this);\r\n    this.loadModel = this.loadModel.bind(this);\r\n    this.setError = this.setError.bind(this);\r\n  }\r\n\r\n  setError(err) {\r\n    /* set local error (to be displayed as small text) */\r\n    this.setState({err:err})\r\n  }\r\n\r\n  loadModel() {\r\n    /* load a custom model */\r\n    this.props.loadModel(this.state.link, this.setError);\r\n  }\r\n\r\n  onChange(e) {\r\n    /* when the textbox is editted */\r\n    this.setState({link:e.target.value});\r\n  }\r\n\r\n  noChange(e) {\r\n    /* the model selection is cancelled and nothing is done \r\n     * if the user clicks on the background\r\n     */\r\n    if (e.target.id === \"background-model-select\" || e.target.id === \"model-blocker\") {\r\n      this.props.toggle();\r\n    }\r\n  }\r\n  render() {\r\n    // empty if not displaying\r\n    if (!this.props.display) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div id=\"background-model-select\" onClick={this.noChange} className=\"select-model-container\">\r\n        <h1>Load a Model</h1>\r\n        <div className=\"model-container\">\r\n          <div className=\"model-new\">\r\n            <h2>New Model</h2>\r\n            <div className=\"d-flex flex-wrap p-2\">\r\n              <div className=\"p-2\"><button type=\"button\" onClick={() => this.props.loadDefaultModel(\"blank\")} className=\"btn btn-secondary\">Blank</button></div>\r\n              <div className=\"p-2\"><button type=\"button\" onClick={() => this.props.loadDefaultModel(\"dense\")} className=\"btn btn-secondary\">Dense</button></div>\r\n              <div className=\"p-2\"><button type=\"button\" onClick={() => this.props.loadDefaultModel(\"conv\")} className=\"btn btn-secondary\">Conv</button></div>\r\n            </div>\r\n            \r\n          </div>\r\n          <div id=\"model-blocker\" className=\"model-blocker\"></div>\r\n          <div className=\"model-load\">\r\n            <h2>Load Model</h2>\r\n            <label>Model link</label>\r\n            <input type=\"text\" className=\"form-control\" placeholder=\"Enter model link\" onChange={this.onChange}></input>\r\n            <small className=\"form-text text-muted\">{this.state.err}</small>\r\n            <br></br>\r\n            <button type=\"button\" className=\"btn btn-secondary\" onClick={this.loadModel}>Load</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n}","import React from 'react';\r\nimport \"./LinkPage.css\";\r\n\r\nexport function LinkPage(props) {\r\n  /* the page showing a link is generated */\r\n  if (!props.display) {\r\n    return null;\r\n  }\r\n  // some code to copy the link to clipboard\r\n  // create a dummy element with the link as text\r\n  // select it and copy the text\r\n  var dummy = document.createElement(\"textarea\");\r\n  document.body.appendChild(dummy);\r\n  dummy.value = props.link;\r\n  dummy.select();\r\n  document.execCommand(\"copy\");\r\n  document.body.removeChild(dummy);\r\n  return (\r\n    <div onClick={e=>{\r\n      if (e.target.id === \"linkpage-container\" || e.target.id === \"linkpage-content\") {\r\n        props.toggle();\r\n      }\r\n    }} className=\"linkpage-container\" id=\"linkpage-container\">\r\n      <div className=\"linkpage-content\" id=\"linkpage-content\">\r\n      <h1>Model Link</h1>\r\n      <input readOnly className=\"form-control\" type=\"text\" value={props.link}/>\r\n      <small className=\"form-text text-muted\">{\"Link copied to clipboard\"}</small>\r\n      </div>\r\n    </div>\r\n  );\r\n  \r\n}","import React from 'react';\r\nimport \"./SetInput.css\";\r\n\r\nexport class SetInput extends React.Component {\r\n  /* the page to select an input dataset */\r\n  constructor(props) {\r\n    super(props);\r\n    this.props = props;\r\n    this.state = {\r\n      err: null, // internal error\r\n      name: \"\", // name of dataset\r\n      link: \"\", // link to dataset\r\n      inputShape: [], // user-specified shape\r\n      outputShape: [],\r\n      inputShapeDisplay: \"\", // texts to display the corresponding shapes\r\n      outputShapeDisplay: \"\",\r\n    }\r\n\r\n    this.onChange = this.onChange.bind(this);\r\n    this.noChange = this.noChange.bind(this);\r\n    this.setError = this.setError.bind(this);\r\n    this.onChangeShapeInput = this.onChangeShapeInput.bind(this);\r\n    this.onChangeShapeOutput = this.onChangeShapeOutput.bind(this);\r\n    this.onChangeName = this.onChangeName.bind(this);\r\n    this.onBlurInput = this.onBlurInput.bind(this);\r\n    this.onBlurOutput = this.onBlurOutput.bind(this);\r\n  }\r\n\r\n  setError(err) {\r\n    /* set internal error */\r\n    this.setState({err:err})\r\n  }\r\n\r\n  onChange(e) {\r\n    /* update the link's text */\r\n    this.setState({link:e.target.value});\r\n  }\r\n\r\n  breakShape(value) {\r\n    /* helper function to break down a string describing an array\r\n     * into an actual array\r\n     */\r\n    let components = String(value).split(\",\");\r\n\r\n    // do not accept empty inputs\r\n    if (components.length === 0) {\r\n      return [];\r\n    }\r\n    for (var i = 0; i < components.length; i++) {\r\n      const num = parseInt(components[i]);\r\n      // do not update if any member of tuple is not a number\r\n      if (isNaN(num)) {\r\n        return null;\r\n      }\r\n      components[i] = num;\r\n    }\r\n    return components;\r\n  }\r\n\r\n  toString(shape) {\r\n    /* convert an array into its string representation */\r\n    if (shape.length === 0) {\r\n      return \"\";\r\n    }\r\n    return shape.join(\",\");\r\n  }\r\n\r\n  onChangeShapeInput(e) {\r\n    /* change the input shape's display (its string) */\r\n    this.setState({\r\n      inputShapeDisplay: e.target.value,\r\n    })\r\n  }\r\n\r\n  onBlurInput(e) {\r\n    /* update the input shape to reflect the user input \r\n     * (stored in inputShapeDisplay), rejecting it if\r\n     * malformed\r\n     */\r\n\r\n    const components = this.breakShape(e.target.value);\r\n    // reject the shape if malformed\r\n    if (components === null) {\r\n      this.setState({\r\n        inputShapeDisplay: this.toString(this.state.inputShape),\r\n      });\r\n      return;\r\n    }\r\n    this.setState({\r\n      inputShape: components,\r\n      inputShapeDisplay: this.toString(components)\r\n    });\r\n  }\r\n\r\n  onChangeShapeOutput(e) {\r\n    /* change the output shape's display (its string) */\r\n    this.setState({\r\n      outputShapeDisplay: e.target.value,\r\n    });\r\n  }\r\n\r\n  onBlurOutput(e) {\r\n    /* update the output shape to reflect the user output \r\n     * (stored in outputShapeDisplay), rejecting it if\r\n     * malformed\r\n     */\r\n    const components = this.breakShape(e.target.value);\r\n    // reject the shape if malformed\r\n    if (components === null) {\r\n      this.setState({\r\n        outputShapeDisplay: this.toString(this.state.outputShape),\r\n      });\r\n      return;\r\n    }\r\n    this.setState({\r\n      outputShape: components,\r\n      outputShapeDisplay: this.toString(components),\r\n    });\r\n  }\r\n  \r\n  onChangeName(e) {\r\n    /* update the name of the dataset */\r\n    this.setState({\r\n      name: e.target.value,\r\n    })\r\n  }\r\n\r\n  noChange(e) {\r\n    /* cancel this page without any changes if background is clicked */\r\n    if (e.target.id === \"background-input-set\" || e.target.id === \"input-blocker\") {\r\n      this.props.toggle();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.display) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div id=\"background-input-set\" onClick={this.noChange} className=\"set-input-container\">\r\n      <h1>Load Input Dataset</h1>\r\n      <div className=\"input-container\">\r\n        <div className=\"input-preset\">\r\n          <h2>Load Preset</h2>\r\n          <div className=\"d-flex flex-wrap p-2\">\r\n            <div className=\"p-2\"><button type=\"button\" onClick={() => this.props.loadDefaultInput(\"MNIST\")} className=\"btn btn-secondary\">MNIST</button></div>\r\n          </div>\r\n          \r\n        </div>\r\n        <div id=\"input-blocker\" className=\"input-blocker\"></div>\r\n        <div className=\"input-load\">\r\n          <h2>Load Custom Dataset (BROKEN)</h2>\r\n          <div className=\"form-group\">\r\n            <input type=\"text\" className=\"form-control\" placeholder=\"Enter input URL\" onChange={this.onChange} value={this.state.link}></input>\r\n          </div>\r\n          <input type=\"text\" className=\"form-control\" placeholder=\"Name\" onChange={this.onChangeName} value={this.state.name}></input>\r\n          <small className=\"form-text\">Shape does not include batchSize</small>\r\n          <div className=\"form-row\">\r\n            \r\n            <div className=\"col\">\r\n              <input type=\"text\" className=\"form-control\" placeholder=\"Input shape\" onChange={this.onChangeShapeInput} onBlur={this.onBlurInput} value={this.state.inputShapeDisplay}></input>\r\n            </div>\r\n            <div className=\"col\">\r\n              <input type=\"text\" className=\"form-control\" placeholder=\"Output shape\" onChange={this.onChangeShapeOutput} onBlur={this.onBlurOutput} value={this.state.outputShapeDisplay}></input>\r\n            </div>\r\n          </div>         \r\n          \r\n          <small className=\"form-text text-muted\">{this.state.err}</small> \r\n          <br></br>\r\n          <button type=\"button\" className=\"btn btn-secondary\" onClick={()=>this.props.loadInput(this.state.link, this.state.name, this.state.inputShape, this.state.outputShape, this.setError)}>Load</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    );\r\n  }\r\n}","export function isCyclic(models) {\r\n  /* Checks if the models constitute directed acyclic graphs\r\n   * (Potentially multiple acyclic graphs)\r\n   * Returns false only if there is an internal loop\r\n   */\r\n  let visited = {}; // whether the node is visited\r\n  let inRecursionStack = {}; // whether the node is in the currentfunction call stack\r\n\r\n  for (const key of Object.keys(models)) {\r\n    visited[key] = false;\r\n    inRecursionStack[key] = false;\r\n  }\r\n\r\n  for (const key of Object.keys(models)) {\r\n    if (isCyclicHelper(models, key, visited, inRecursionStack)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isCyclicHelper(models, index, visited, inRecursionStack) {\r\n  /* A helper function to explore from a single node. Returns\r\n   * false if there is no discrepancy found from this index \r\n   */\r\n\r\n  // if visited, remove out of stack and say no\r\n  if (visited[index]) {\r\n    inRecursionStack[index] = false;\r\n    return false;\r\n  }\r\n\r\n  visited[index] = true;\r\n  inRecursionStack[index] = true;\r\n  // if no neighbor, then no discrepancy\r\n  if (models[index].connectedTo === null) {\r\n    inRecursionStack[index] = false; \r\n    return false;\r\n  }\r\n\r\n  const next = models[index].connectedTo;\r\n  if (!visited[next] && isCyclicHelper(models, next, visited, inRecursionStack)) {\r\n    return true;\r\n  }\r\n  // if we bump into a node on our incoming path, it's bad\r\n  if (inRecursionStack[next]) {\r\n    return true;\r\n  }\r\n\r\n  inRecursionStack[index] = false;\r\n  return false;\r\n}\r\n\r\nexport function isLinear(models) {\r\n  /* checks if the model current makes sense:\r\n   * all nodes cannot have > 1 incoming edge\r\n   * input node cannot have incoming edge\r\n   * output node cannot have outgoing edge\r\n   */ \r\n  let numIncomingEdges = {};\r\n  for (const key of Object.keys(models)) {\r\n    numIncomingEdges[key] = 0;\r\n  }\r\n\r\n  for (const key of Object.keys(models)) {\r\n    const next = models[key].connectedTo;\r\n    if (next !== null) {\r\n      numIncomingEdges[next] += 1;\r\n    }\r\n  }\r\n\r\n  // the input node must not have incoming edges\r\n  if (numIncomingEdges[0] !== 0) {\r\n    return {ok: false, err: \"Input node cannot have incoming edge\"};\r\n  }\r\n  // the output node must not have outgoing edges\r\n  if (models[1].connectedTo !== null) {\r\n    return {ok: false, err: \"Output node cannot have outgoing edge\"}; \r\n  }\r\n  for (const key of Object.keys(models)) {\r\n    if (numIncomingEdges[key] > 1) {\r\n      return {\"ok\": false, err:\"No node can have more than one incoming edge\"};\r\n    }\r\n  }\r\n  return {\"ok\": true, err:\"\"};\r\n}\r\n\r\nexport function prev(models, id) {\r\n  /* Returns id of the node linking to the model pointed \r\n   * to by the id, if any; if none, return null \r\n   */\r\n  for (const key of Object.keys(models)) {\r\n    if (models[key].connectedTo === id) {\r\n      return key;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function isTrainable(models) {\r\n  /* Is the current architecture trainable? */\r\n  const resp = isLinear(models);\r\n  // if not linear, then fail\r\n  if (!resp[\"ok\"]) {\r\n    return resp;\r\n  }\r\n  if (isCyclic(models)) {\r\n    return {ok: false, err: \"Model cannot be cyclic\"};\r\n  }\r\n  \r\n  // output node must not be empty, \r\n  // have ndim = 2, and agree with batch size\r\n  if (models[1].shapeIn === null || models[1].shapeOut.length !== 2) {\r\n    return {ok: false, err: \"Output node must have shape (batchSize, categories)\"};\r\n  }\r\n\r\n  let currentNode = models[0]; // input node\r\n  while (currentNode.ID !== 1) { // need to reach output node\r\n    if (currentNode.connectedTo === null) {\r\n      return {ok: false, err: \"Model does not connect from input node to output node\"};\r\n    }\r\n    currentNode = models[currentNode.connectedTo];\r\n  }\r\n  return {ok: true, err: \"\"};\r\n}","import React from \"react\";\r\nimport \"./TrainSetup.css\";\r\n\r\nfunction Option(props) {\r\n  /* one option on the list, specially shown if selected */\r\n  const className = (props.selected === props.name) ? \"btn btn-info\" : \"btn btn-secondary\"\r\n  return (\r\n    <div className=\"p-2\">\r\n      <button type=\"button\" onClick={() => props.select(props.name)} className={className}>{props.displayName}</button>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport class TrainSetup extends React.Component {\r\n  /* the page setting details of training configuration */\r\n  constructor(props) {\r\n    super(props);\r\n    this.props = props;\r\n\r\n    this.onClick = this.onClick.bind(this);\r\n  }\r\n\r\n  onClick(e) {\r\n    /* cancel this page if background is clicked */\r\n    if (e.target.id === \"background-input-set\") {\r\n      this.props.toggle();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.display) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div id=\"background-input-set\" className=\"set-input-container\" onClick={this.onClick}>\r\n      <h1>Setup Training Details</h1>\r\n      <div className=\"input-container\">\r\n        <div className=\"input-preset\">\r\n          <h2>Optimizer</h2>\r\n          <div>\r\n            Learning Rate: <input id=\"learning-rate\" type=\"number\" step=\"any\" value={this.props.modelInfo.learningRate} onChange={() => this.props.update(\"learningRate\", parseFloat(document.getElementById(\"learning-rate\").value))} min=\"0\"></input>\r\n          </div>\r\n          <div className=\"d-flex flex-wrap p-2\">\r\n            <Option name=\"adam\" displayName=\"Adam\" selected={this.props.modelInfo.optimizer} select={(v)=>this.props.update(\"optimizer\", v)}></Option>\r\n            <Option name=\"sgd\" displayName=\"SGD\" selected={this.props.modelInfo.optimizer} select={(v)=>this.props.update(\"optimizer\", v)}></Option>\r\n            <Option name=\"rmsProp\" displayName=\"RMS Prop\" selected={this.props.modelInfo.optimizer} select={(v)=>this.props.update(\"optimizer\", v)}></Option>\r\n          </div>\r\n        </div>\r\n\r\n        <div id=\"input-blocker\" className=\"input-blocker\"></div>\r\n        <div className=\"input-load\">\r\n          <h2>Loss</h2>\r\n          <div className=\"d-flex flex-wrap p-2\">\r\n            <Option name=\"mse\" displayName=\"Mean Squared Error\" selected={this.props.modelInfo.loss} select={(v)=>this.props.update(\"loss\", v)}></Option>\r\n            <Option name=\"logcosh\" displayName=\"Log Cosh\" selected={this.props.modelInfo.loss} select={(v)=>this.props.update(\"loss\", v)}></Option>\r\n            <Option name=\"cce\" displayName=\"Categorical Crossentropy\" selected={this.props.modelInfo.loss} select={(v)=>this.props.update(\"loss\", v)}></Option>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      </div>\r\n      );\r\n    }\r\n}","import * as tf from '@tensorflow/tfjs';\r\n\r\nexport function compileModel(models,modelInfo) {\r\n  const model = getModel(models, modelInfo);\r\n  const optimizer = getOptimizer(modelInfo);\r\n  const loss = getLoss(modelInfo.loss);\r\n  model.compile({\r\n    optimizer: optimizer,\r\n    loss: loss,\r\n    metrics: ['acc']\r\n  });\r\n  return model;\r\n}\r\n\r\nfunction getLoss(loss) {\r\n  let loss_fn = null;\r\n  switch (loss) {\r\n    case \"mse\":\r\n      loss_fn = tf.losses.meanSquaredError;\r\n      break;\r\n    case \"logcosh\":\r\n      loss_fn = \"logcosh\";\r\n      break;\r\n    case \"cce\":\r\n      loss_fn = \"categoricalCrossentropy\";\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n  return loss_fn;\r\n}\r\n\r\nfunction getOptimizer(modelInfo) {\r\n  let optimizer = null;\r\n  switch (modelInfo.optimizer) {\r\n    case \"adam\":\r\n      optimizer = tf.train.adam\r\n      break;\r\n    case \"sgd\":\r\n      optimizer = tf.train.sgd;\r\n      break;\r\n    case \"rmsprop\":\r\n      optimizer = tf.train.rmsprop;\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n  return optimizer(modelInfo.learningRate);\r\n}\r\n\r\nfunction getModel(models, modelInfo) {\r\n  let layers = {};\r\n  Object.keys(models).map((key, index) => {\r\n    const model = models[key];\r\n    layers[key] = compileLayer(model,modelInfo);\r\n    return null;\r\n  });\r\n  const model = tf.sequential();\r\n  let current_id = 0;\r\n  do {\r\n    model.add(layers[current_id]);\r\n    current_id = models[current_id].connectedTo;\r\n  } while (models[current_id].type !== \"output\")\r\n  model.add(layers[current_id]);\r\n  return model;\r\n}\r\n\r\nfunction compileLayer(model, modelInfo) {\r\n  const f = getLayerF(model);\r\n  let para = JSON.parse(JSON.stringify(model.parameters)); // make a copy\r\n  para.activation = model.activation;\r\n  if (model.type === \"input\") {\r\n    para.inputShape = model.shapeIn.slice(1);\r\n  } else if (model.type === \"output\") {\r\n    para.units = model.shapeOut.slice(1)[0];\r\n  } else if (model.type === \"embedding\") {\r\n    para.inputDim = modelInfo.maxToken;\r\n    para.outputDim = para.units;\r\n  }\r\n  return f(para);\r\n}\r\n\r\nfunction getLayerF(model) {\r\n  let f = null;\r\n  const shape = model.shapeIn.slice(1, model.shapeIn.length-1);\r\n\r\n  switch (model.type) {\r\n    case \"input\":\r\n      f = tf.layers.inputLayer;\r\n      break;\r\n    case \"output\":\r\n      f = tf.layers.dense;\r\n      break;\r\n    case \"dense\":\r\n      f = tf.layers.dense;\r\n      break;\r\n    case \"conv\":\r\n      if (shape.length === 1) {\r\n        f = tf.layers.conv1d;\r\n      } else if (shape.length === 2) {\r\n        f = tf.layers.conv2d;\r\n      }\r\n      break;\r\n    case \"maxpool\":\r\n      if (shape.length === 1) {\r\n        f = tf.layers.maxPooling1d;\r\n      } else if (shape.length === 2) {\r\n        f = tf.layers.maxPooling2d;\r\n      }\r\n      break;\r\n    case \"flatten\":\r\n      f = tf.layers.flatten;\r\n      break;\r\n    case \"embedding\":\r\n      f = tf.layers.embedding;\r\n      break;\r\n    case \"dropout\":\r\n      f = tf.layers.dropout;\r\n      break;\r\n    default:\r\n      break; \r\n  }\r\n  return f;\r\n}","/**\r\n * @license\r\n * Copyright 2018 Google LLC. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n * =============================================================================\r\n */\r\n\r\nimport * as tf from '@tensorflow/tfjs';\r\n\r\nexport const IMAGE_H = 28;\r\nexport const IMAGE_W = 28;\r\nconst IMAGE_SIZE = IMAGE_H * IMAGE_W;\r\nconst NUM_CLASSES = 10;\r\nconst NUM_DATASET_ELEMENTS = 65000;\r\n\r\nconst NUM_TRAIN_ELEMENTS = 55000;\r\n\r\nconst MNIST_IMAGES_SPRITE_PATH =\r\n    'https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png';\r\nconst MNIST_LABELS_PATH =\r\n    'https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8';\r\n\r\n/**\r\n * A class that fetches the sprited MNIST dataset and provide data as\r\n * tf.Tensors.\r\n */\r\nexport class MnistData {\r\n  async load() {\r\n    // Make a request for the MNIST sprited image.\r\n    const img = new Image();\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    const imgRequest = new Promise((resolve, reject) => {\r\n      img.crossOrigin = '';\r\n      img.onload = () => {\r\n        img.width = img.naturalWidth;\r\n        img.height = img.naturalHeight;\r\n\r\n        const datasetBytesBuffer =\r\n            new ArrayBuffer(NUM_DATASET_ELEMENTS * IMAGE_SIZE * 4);\r\n\r\n        const chunkSize = 5000;\r\n        canvas.width = img.width;\r\n        canvas.height = chunkSize;\r\n\r\n        for (let i = 0; i < NUM_DATASET_ELEMENTS / chunkSize; i++) {\r\n          const datasetBytesView = new Float32Array(\r\n              datasetBytesBuffer, i * IMAGE_SIZE * chunkSize * 4,\r\n              IMAGE_SIZE * chunkSize);\r\n          ctx.drawImage(\r\n              img, 0, i * chunkSize, img.width, chunkSize, 0, 0, img.width,\r\n              chunkSize);\r\n\r\n          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n          for (let j = 0; j < imageData.data.length / 4; j++) {\r\n            // All channels hold an equal value since the image is grayscale, so\r\n            // just read the red channel.\r\n            datasetBytesView[j] = imageData.data[j * 4] / 255;\r\n          }\r\n        }\r\n        this.datasetImages = new Float32Array(datasetBytesBuffer);\r\n\r\n        resolve();\r\n      };\r\n      img.src = MNIST_IMAGES_SPRITE_PATH;\r\n    });\r\n\r\n    const labelsRequest = fetch(MNIST_LABELS_PATH);\r\n    const [_, labelsResponse] =\r\n        await Promise.all([imgRequest, labelsRequest]);\r\n\r\n    this.datasetLabels = new Uint8Array(await labelsResponse.arrayBuffer());\r\n\r\n    // Slice the the images and labels into train and test sets.\r\n    this.trainImages =\r\n        this.datasetImages.slice(0, IMAGE_SIZE * NUM_TRAIN_ELEMENTS);\r\n    this.testImages = this.datasetImages.slice(IMAGE_SIZE * NUM_TRAIN_ELEMENTS);\r\n    this.trainLabels =\r\n        this.datasetLabels.slice(0, NUM_CLASSES * NUM_TRAIN_ELEMENTS);\r\n    this.testLabels =\r\n        this.datasetLabels.slice(NUM_CLASSES * NUM_TRAIN_ELEMENTS);\r\n  }\r\n\r\n  /**\r\n   * Get all training data as a data tensor and a labels tensor.\r\n   *\r\n   * @returns\r\n   *   xs: The data tensor, of shape `[numTrainExamples, 28, 28, 1]`.\r\n   *   labels: The one-hot encoded labels tensor, of shape\r\n   *     `[numTrainExamples, 10]`.\r\n   */\r\n  getTrainData(numTrainExapmles) {\r\n    let xs = tf.tensor4d(\r\n        this.trainImages,\r\n        [this.trainImages.length / IMAGE_SIZE, IMAGE_H, IMAGE_W, 1]);\r\n    let labels = tf.tensor2d(\r\n      this.trainLabels, [this.trainLabels.length / NUM_CLASSES, NUM_CLASSES]);\r\n\r\n    if (numTrainExapmles != null) {\r\n      xs = xs.slice([0, 0, 0, 0], [numTrainExapmles, IMAGE_H, IMAGE_W, 1]);\r\n      labels = labels.slice([0, 0], [numTrainExapmles, NUM_CLASSES]);\r\n    }\r\n    return [xs, labels];\r\n  }\r\n\r\n  /**\r\n   * Get all test data as a data tensor a a labels tensor.\r\n   *\r\n   * @param {number} numExamples Optional number of examples to get. If not\r\n   *     provided,\r\n   *   all test examples will be returned.\r\n   * @returns\r\n   *   xs: The data tensor, of shape `[numTestExamples, 28, 28, 1]`.\r\n   *   labels: The one-hot encoded labels tensor, of shape\r\n   *     `[numTestExamples, 10]`.\r\n   */\r\n  getTestData(numExamples) {\r\n    let xs = tf.tensor4d(\r\n        this.testImages,\r\n        [this.testImages.length / IMAGE_SIZE, IMAGE_H, IMAGE_W, 1]);\r\n    let labels = tf.tensor2d(\r\n        this.testLabels, [this.testLabels.length / NUM_CLASSES, NUM_CLASSES]);\r\n\r\n    if (numExamples != null) {\r\n      xs = xs.slice([0, 0, 0, 0], [numExamples, IMAGE_H, IMAGE_W, 1]);\r\n      labels = labels.slice([0, 0], [numExamples, NUM_CLASSES]);\r\n    }\r\n    return [xs, labels];\r\n  }\r\n}","import React from 'react';\r\nimport {Sidebar} from \"./Sidebar.js\";\r\nimport {CanvasContainer} from \"./Canvas.js\";\r\nimport {Toolbar} from \"./Toolbar.js\";\r\nimport {ErrorBox} from \"./ErrorBox.js\";\r\nimport {SelectModel} from \"./SelectModel.js\";\r\nimport {LinkPage} from \"./LinkPage.js\";\r\nimport {SetInput} from \"./SetInput.js\";\r\nimport {isCyclic, isLinear, isTrainable} from \"./Utils.js\";\r\nimport {nodeTypes, blankModel, denseModel, convModel} from \"./ModelInfo.js\";\r\nimport {getModel, saveModel, generateLink, getIDFromLink, loadInput} from \"./Server.js\";\r\nimport {TrainSetup} from \"./TrainSetup.js\";\r\nimport {DATASET_SHAPE} from \"./Constants.js\";\r\nimport {compileModel} from \"./Model.js\";\r\nimport {MnistData} from \"./Data.js\";\r\nimport cloneDeep from 'lodash/cloneDeep';\r\nimport './App.css';\r\n\r\nexport class App extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n  \r\n    this.state = {\r\n      models: { // represent the architecture\r\n        0: this._model(\"input\", 0, 20, 50),\r\n        1: this._model(\"output\", 1, 300, 50),\r\n      },\r\n      modelInfo: {\r\n        epochs: \"2\",\r\n        batchSize: \"25\",\r\n        maxToken: null,\r\n        loss: \"cce\", // loss function\r\n        optimizer: \"adam\",\r\n        learningRate: \"0.01\",\r\n      },\r\n      selected: 0, // selected node;\r\n      nextID: 2, // the ID for the next new layer; incremented as model grows\r\n      errorMsg: null, // error message\r\n      errorOnce: false, // whether the current error message can be cancelled \r\n      trainingInfo: {\r\n        accuracy: null,\r\n        testAccuracy: null,\r\n        loss: null,\r\n        progress: null,\r\n        status: \"Edit\", // whether the model is getting trained or editted\r\n        currentEpoch: 0,\r\n        correct: 0,\r\n        total: 0,\r\n        batchesPerEpoch: null,\r\n      },\r\n      \r\n      editableSelected: false, // whether an editable element of the toolbar is selected\r\n      selectModelPage: true, // is it in the page selecting model or main page\r\n      linkPage: false, // is link page on display\r\n      link: null, // the link for the current model\r\n      settingInput: false, // are we on a page to set input?\r\n      trainSetup: false, // are we customizing training information?\r\n    };\r\n\r\n    // function bindings\r\n    this.newModel = this.newModel.bind(this);\r\n    this.updateModel = this.updateModel.bind(this);\r\n    this.selectModel = this.selectModel.bind(this);\r\n    this.removeModel = this.removeModel.bind(this);\r\n\r\n    this.setEditableSelected = this.setEditableSelected.bind(this);\r\n    this.updateModelInfo = this.updateModelInfo.bind(this);\r\n    this.setError = this.setError.bind(this);\r\n\r\n    this.trainCloud = this.trainCloud.bind(this);    \r\n    this.startSession = this.startSession.bind(this);\r\n    this.endSession = this.endSession.bind(this); \r\n    this.updateTrain = this.updateTrain.bind(this);\r\n    this.cancelTrain = this.cancelTrain.bind(this);\r\n    this.state[\"models\"] = this._updateDependents(this.state.models);\r\n\r\n    this.loadDefaultModel = this.loadDefaultModel.bind(this);\r\n    this.loadModel = this.loadModel.bind(this);\r\n    this.downloadModel = this.downloadModel.bind(this);\r\n\r\n    this.getLink = this.getLink.bind(this);\r\n    this.setInput = this.setInput.bind(this);\r\n    this.loadDefaultInput = this.loadDefaultInput.bind(this);\r\n    this.loadCustomInput = this.loadCustomInput.bind(this);\r\n\r\n    this.trainSetup = this.trainSetup.bind(this);\r\n  }\r\n\r\n  _model(type, id, x, y) {\r\n    /* Helper function to make a new model (for a layer) given id and its position\r\n     */\r\n    return {\r\n      name: type + String(id),\r\n      ID: id,\r\n      type: type,\r\n      x: x,\r\n      y: y,\r\n      connectedTo: null,\r\n      shapeIn: null, // dependent\r\n      shapeOut: null, // dependent\r\n      activation: null,\r\n      parameters: cloneDeep(nodeTypes[type].defaultParameters),\r\n    };\r\n  }\r\n\r\n  model(type) {\r\n    /* Function to make a new model given its layer type, putting\r\n     * it in a random location on the upper left corner of the canvas\r\n     */\r\n    return this._model(type, this.state.nextID, 10 + Math.random() * 80, 10 + Math.random() * 80);\r\n  }\r\n  updateDependents(models) {\r\n    /* Given the current models, return models with the dependents\r\n     * (parameters updated given the independent variables) updated\r\n     * also reset the error (and may set some new ones given what happens in\r\n     * updating dependents)\r\n     */\r\n    this.setError(null, false);\r\n    return this._updateDependents(models);\r\n  }\r\n  _updateDependents(models) {\r\n    /* helper function to update members of nodes\r\n     * that depend on other parts of the system \r\n     */\r\n    // get the input model\r\n    let inputNode = models[0];\r\n    inputNode.shapeOut = nodeTypes[inputNode.type].shapeOut(inputNode.parameters, this.state.modelInfo, this.setError);\r\n    inputNode.shapeIn = inputNode.shapeOut;\r\n    let currentNode = inputNode;\r\n    let nextNode = models[inputNode.connectedTo];\r\n    while (currentNode.connectedTo !== null) {\r\n      nextNode.shapeIn = currentNode.shapeOut;\r\n      if (nextNode.type === \"input\") {\r\n        nextNode.shapeOut = nodeTypes[nextNode.type].shapeOut(nextNode.parameters, this.state.modelInfo, this.setError);\r\n      } else {\r\n        nextNode.shapeOut = nodeTypes[nextNode.type].shapeOut(nextNode.parameters, nextNode.shapeIn, this.setError);\r\n      }\r\n      \r\n      currentNode = nextNode;\r\n      nextNode = models[nextNode.connectedTo];\r\n    }\r\n    return models;\r\n  }\r\n\r\n  newModel(type) {\r\n    const oldModels = {...this.state.models};\r\n    let newModels = {...oldModels, [this.state.nextID]: this.model(type)};\r\n    newModels = this.updateDependents(newModels);\r\n    this.setState({\r\n      models: newModels,\r\n      nextID: this.state.nextID + 1,\r\n    });\r\n  }\r\n\r\n  selectModel(id) {\r\n    this.setState({\r\n      selected: id,\r\n    })\r\n  }\r\n\r\n  updateModel(id, dict) {\r\n    /* given a dict of properties to update ((name, value) pairs)\r\n     * updates the model of the given id\r\n     */\r\n    let models = {...this.state.models};\r\n    for (const key of Object.keys(dict)) {\r\n      models[id][key] = dict[key];\r\n    }\r\n    if (isCyclic(models)) {\r\n      this.setError(\"Graph cannot have loops\", false);\r\n      return;\r\n    } else if (!isLinear(models)[\"ok\"]) {\r\n      this.setError(isLinear(models)[\"err\"], false);\r\n      return;\r\n    } else {\r\n      this.setError(null, false)\r\n    }\r\n\r\n    models = this.updateDependents(models);\r\n    this.setState({\r\n      models: models,\r\n    });\r\n    \r\n  }\r\n\r\n  removeModel(id) {\r\n    /* given an id, removes the corresponding model\r\n     * and all connections to it\r\n     */\r\n\r\n    // get filtered models\r\n    let newModels = {};\r\n    for (const key of Object.keys(this.state.models)) {\r\n      if (this.state.models[key].ID !== id) {\r\n        newModels[key] = this.state.models[key];\r\n      }\r\n    }\r\n\r\n    for (const key of Object.keys(newModels)) {\r\n      if (newModels[key].connectedTo === id) {\r\n        newModels[key].connectedTo = null;\r\n      }\r\n    }\r\n\r\n    newModels = this.updateDependents(newModels);\r\n    this.setState({\r\n      models: newModels,\r\n    });\r\n  }\r\n\r\n  updateParameters(id, name, value, canTuple, floatOkay=false) {\r\n    /* given a name and a value\r\n     * updates the parameters of the model of the given id\r\n     */\r\n    // copy the model\r\n    const model = {...this.state.models[id]};\r\n\r\n    // now, important: check to ensure value is integer or tuple or integer\r\n    let components = String(value).split(\",\");\r\n\r\n    // do not accept empty inputs\r\n    if (components.length === 0) {\r\n      return;\r\n    }\r\n    for (var i = 0; i < components.length; i++) {\r\n      const num = floatOkay ? parseFloat(components[i]) : parseInt(components[i]);\r\n      // do not update if any member of tuple is not a number\r\n      if (isNaN(num)) {\r\n        return;\r\n      }\r\n      components[i] = num;\r\n    }\r\n    // if tuple, set array\r\n    if (components.length > 1) {\r\n      // no tuples for things that can't tuple\r\n      if (!canTuple) {\r\n        return;\r\n      }\r\n      model[\"parameters\"][name] = components;\r\n    } else {\r\n      model[\"parameters\"][name] = components[0];\r\n    }\r\n    let models = {...this.state.models}; // make a copy\r\n    \r\n    models[id] = model;\r\n    models = this.updateDependents(models);\r\n    this.setState({\r\n      models: models,\r\n    });\r\n  }\r\n\r\n  updateModelInfo(name, value, intOnly=false) {\r\n    /* update a key value pair of a model\r\n     * if intOnly is true, then the value must be an\r\n     * integer, or else it is rejected\r\n     */\r\n    \r\n    // reject non-ints\r\n    if (intOnly) {\r\n      if (isNaN(value) || value === \"\") {\r\n        return;\r\n      }\r\n    }\r\n    let modelInfo = this.state.modelInfo\r\n    modelInfo[name] = value;\r\n    this.setState({\r\n      modelInfo: modelInfo,\r\n    });\r\n  }\r\n\r\n  setError(err, once) {\r\n    /* sets the error message */\r\n    if (once) {\r\n      this.setState({\r\n        errorMsg: err,\r\n        errorOnce: once,\r\n      });\r\n    } else {\r\n      // do not override one-time messages\r\n      if (this.state.errorOnce && this.state.errorMsg !== null) {\r\n        return;\r\n      } else {\r\n        this.setState({\r\n          errorMsg: err,\r\n          errorOnce: once,\r\n        });\r\n      }\r\n    }\r\n    \r\n  }\r\n  \r\n  setEditableSelected(t) {\r\n    /* set whether an editable model is selected */\r\n    this.setState({\r\n      editableSelected: t,\r\n    });\r\n  }\r\n\r\n  trainCloud() {\r\n    /* train the model on cloud, if the model is \r\n     * well-formed\r\n     */\r\n\r\n    // first check if the model is linear\r\n    const models = this.updateDependents(this.state.models);\r\n    this.setState({\r\n      models: models,\r\n    })\r\n\r\n    // then we check if the model is well-formed\r\n    const resp = isTrainable(models);\r\n    if (!resp[\"ok\"]) {\r\n      this.setError(resp[\"err\"], true);\r\n      return;\r\n    }\r\n\r\n    const model = compileModel(this.state.models, this.state.modelInfo);\r\n\r\n    this.startSession(model);\r\n  }\r\n\r\n  \r\n\r\n  startSession(model) {\r\n    /* start training session */\r\n    // periodically retrieve latest training info\r\n    let trainingInfo = this.state.trainingInfo;\r\n    trainingInfo.status = 'Loading...';\r\n\r\n    this.setState({trainingInfo: trainingInfo});\r\n    const data = new MnistData();\r\n    const updateTrain = this.updateTrain;\r\n    const endSession = this.endSession;\r\n    data.load().then(() => {\r\n      const [xs, ys] = data.getTrainData(10000);\r\n      \r\n      trainingInfo.status = 'Training';\r\n      trainingInfo.batchesPerEpoch = Math.floor(xs.shape[0] / this.state.modelInfo.batchSize);\r\n      trainingInfo.currentEpoch = -1; // as the first call will add 1\r\n      this.setState({trainingInfo: trainingInfo});\r\n      model.fit(xs, ys, {\r\n        epochs: parseInt(this.state.modelInfo.epochs),\r\n        batchSize: parseInt(this.state.modelInfo.batchSize),\r\n        callbacks: {onBatchEnd: (batch, logs) => updateTrain(model, batch, logs), onTrainEnd: (logs) => endSession(model, data)},\r\n        validationSplit: 0.1,\r\n      });\r\n      \r\n    })\r\n    this.selectModel(-1); // deselect any model to show training progress\r\n  }\r\n\r\n  \r\n\r\n  updateTrain(model, batch, logs) {\r\n    /* update the information about the current training session */\r\n    // if early stopping\r\n    if (this.state.trainingInfo.status === \"Edit\") {\r\n      model.stopTraining = true;\r\n      return;\r\n    }\r\n    let trainingInfo = this.state.trainingInfo;\r\n    if (batch === 0) {\r\n      trainingInfo.currentEpoch += 1;\r\n      trainingInfo.correct = 0;\r\n      trainingInfo.total = 0;\r\n    }\r\n    const batchSize = parseInt(this.state.modelInfo.batchSize);\r\n    const epochs = this.state.modelInfo.epochs;\r\n    const batchesPerEpoch = this.state.trainingInfo.batchesPerEpoch;\r\n    const currentEpoch = trainingInfo.currentEpoch;\r\n\r\n    const correct = logs.acc * batchSize;\r\n    trainingInfo.correct += correct;\r\n    trainingInfo.total += batchSize;\r\n    trainingInfo.accuracy = trainingInfo.correct / trainingInfo.total;\r\n    trainingInfo.loss = logs.loss;\r\n    trainingInfo.progress = (currentEpoch / epochs) + (batch / batchesPerEpoch) / epochs;\r\n    this.setState({trainingInfo: trainingInfo});\r\n    return;\r\n  }\r\n\r\n  endSession(model, data) {\r\n    let trainingInfo = this.state.trainingInfo;\r\n    trainingInfo.progress = 1;\r\n    trainingInfo.currentEpoch = 0;\r\n    trainingInfo.status = \"Test\";\r\n    this.setState({trainingInfo: trainingInfo});\r\n\r\n    // then evaluate the model\r\n    const [xs, ys] = data.getTestData();\r\n    const result = model.evaluate(xs, ys);\r\n    const testAccuracy = result[1].as1D().dataSync()[0];\r\n    trainingInfo.testAccuracy = testAccuracy;\r\n    trainingInfo.status = \"Edit\";\r\n    trainingInfo.progress = 0;\r\n    this.setState({trainingInfo: trainingInfo});\r\n  }\r\n\r\n  cancelTrain() {\r\n    /* cancel the training session */\r\n    let trainingInfo = this.state.trainingInfo;\r\n    trainingInfo['status'] = \"Edit\";\r\n    this.setState({trainingInfo:trainingInfo});\r\n  }\r\n\r\n  loadModel(link, setError) {\r\n    /* load a stored model from a model's link */\r\n\r\n    // get model ID\r\n    getIDFromLink(link).then(modelID => {\r\n      // then get the model itself given the ID\r\n      getModel(modelID).then(modelJSON => {\r\n        const decoded = JSON.parse(modelJSON);\r\n        let modelInfo = this.state.modelInfo;\r\n        this.setState({\r\n          modelInfo: modelInfo,\r\n          models: decoded['model'],\r\n          // find the largest index\r\n          nextID: Math.max(...Object.keys(decoded['model']).map(key => Number(key)))+1,\r\n          selectModelPage: false,\r\n        });\r\n        setError(null);\r\n      }).catch(err => {\r\n        setError(err.message);\r\n      })\r\n    }).catch(err => {\r\n      setError(err.message);\r\n    });\r\n  }\r\n\r\n  loadDefaultModel(name) {\r\n    /* load one of the preset default models */\r\n    let model = null;\r\n    switch (name) {\r\n      case \"blank\":\r\n        model = blankModel;\r\n        break;\r\n      case \"dense\":\r\n        model = denseModel;\r\n        break;\r\n      case \"conv\":\r\n        model = convModel;\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n    this.setState({\r\n      nextID: Math.max(...Object.keys(model['model']).map(key => Number(key)))+1,\r\n      models: model['model'],\r\n      modelInfo: model['modelInfo'],\r\n      selectModelPage: false,\r\n    });\r\n\r\n  }\r\n\r\n  getLink() {\r\n    /* get a link for the current model */\r\n    const models = this.updateDependents(this.state.models);\r\n    this.setState({\r\n      models: models,\r\n    })\r\n    const serializedModel = JSON.stringify({\r\n      modelJSON: JSON.stringify({model: models, modelInfo: this.state.modelInfo}),\r\n    });\r\n    \r\n    // save the model first then get a link\r\n    saveModel(serializedModel).then(responseJSON => {\r\n      generateLink(responseJSON[\"data\"][\"id\"]).then( responseJSON => {\r\n        const link = responseJSON['data']['link'];\r\n        this.setState({\r\n          link: link,\r\n          linkPage: true,\r\n        });\r\n      }).catch(err => {\r\n        this.setError(err.message, true);\r\n      });\r\n    }).catch(err => {\r\n      this.setError(err.message, true);\r\n    });\r\n    \r\n  }\r\n\r\n  async downloadModel() {\r\n    /* download the current model */\r\n\r\n    // first update dependent to make sure things are right\r\n    const models = this.updateDependents(this.state.models);\r\n    this.setState({\r\n      models: models,\r\n    })\r\n\r\n    // check if model is well-formed\r\n    const resp = isTrainable(models);\r\n    if (!resp[\"ok\"]) {\r\n      this.setError(resp[\"err\"], true);\r\n      return;\r\n    }\r\n\r\n    // compile the model\r\n    const model = compileModel(models, this.state.modelInfo);\r\n    await model.save(\"downloads://tfjs-model\");\r\n  }\r\n\r\n  loadDefaultInput(name) {\r\n    /* load an input dataset that is preset */\r\n    \r\n    let models = this.state.models;\r\n    // set the parameters of the current model\r\n    models[0]['parameters']['data'] = name;\r\n    models[0]['parameters']['inputShape'] = DATASET_SHAPE[name].input;\r\n    models[1]['parameters']['outputShape'] = DATASET_SHAPE[name].output;\r\n\r\n    let modelInfo = this.state.modelInfo;\r\n    if (name === \"IMDB\")\r\n      modelInfo['maxToken'] = 1000;\r\n    this.setState({\r\n      // update dependent to make shapes correct\r\n      models: this.updateDependents(models), \r\n      settingInput: false,\r\n      modelInfo: modelInfo,\r\n    });\r\n  }\r\n\r\n  loadCustomInput(url, name, inputShape, outputShape, setError) {\r\n    /* load a user custom input set */\r\n\r\n    // make sure all the inputs are reasonable\r\n    if (inputShape.length === 0 || outputShape.length === 0) {\r\n      setError(\"Input and output shapes must be set\");\r\n      return;\r\n    }\r\n    if (name === null) {\r\n      setError(\"Name your dataset!\");\r\n      return;\r\n    }\r\n\r\n    // load the input from server\r\n    loadInput(url, name, inputShape, outputShape).catch(e => {\r\n      setError(e.message);\r\n      return;\r\n    }).then(data => {\r\n      let models = this.state.models;\r\n      // store them into the current model\r\n      models[0].parameters['data'] = data.datasetName;\r\n      models[0].parameters['inputShape'] = JSON.parse(data.inputShape);\r\n      models[0].parameters['datasetID'] = data.datasetID;\r\n      models[1].parameters['data'] = data.datasetName;\r\n      models[1].parameters['outputShape'] = JSON.parse(data.outputShape);\r\n      // keep shapes correct\r\n      models = this.updateDependents(models);\r\n\r\n      this.setState({\r\n        models: models,\r\n        settingInput: false,\r\n      });\r\n    });\r\n  }\r\n\r\n  setInput() {\r\n    /* bring up the setting input page */\r\n    this.setState({\r\n      settingInput: true,\r\n    });\r\n  }\r\n\r\n  trainSetup() {\r\n    /* bring up the train setup page */\r\n    this.setState({\r\n      trainSetup: true,\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <LinkPage display={this.state.linkPage} link={this.state.link} toggle={()=>this.setState({linkPage: false})}/>\r\n        <SelectModel display={this.state.selectModelPage} loadModel={this.loadModel} loadDefaultModel={this.loadDefaultModel} toggle={()=>this.setState({selectModelPage: false})}></SelectModel>\r\n        <SetInput display={this.state.settingInput} loadDefaultInput={this.loadDefaultInput} loadInput={this.loadCustomInput} toggle={()=>{this.setState({settingInput: false})}}></SetInput>\r\n        <TrainSetup display={this.state.trainSetup} toggle={()=>this.setState({trainSetup: false})} modelInfo={this.state.modelInfo} update={this.updateModelInfo}></TrainSetup>\r\n        <ErrorBox errorMsg={this.state.errorMsg} dismissible={this.state.errorOnce} setError={this.setError}/>\r\n        <div className=\"container-fluid d-flex h-100 flex-row no-margin\">\r\n          <Sidebar models={this.state.models} selected={this.state.selected} trainingInfo={this.state.trainingInfo} newModel={this.newModel} setError={this.setError} update={this.updateModel} setSelectModelPage={() => this.setState({selectModelPage:true})} trainCloud={this.trainCloud} cancelTrain={this.cancelTrain} getLink={this.getLink} downloadModel={this.downloadModel} setInput={this.setInput}/>\r\n          <div className=\"d-flex w-100 p-2 flex-column flex-grow-1 no-margin\" ref=\"canvasContainer\">\r\n            <CanvasContainer models={this.state.models} selected={this.state.selected} select={this.selectModel} update={this.updateModel} remove={this.removeModel} editableSelected={this.state.editableSelected}/>\r\n            <Toolbar trainSetup={this.trainSetup} modelInfo={this.state.modelInfo} setInputDataset={this.setInput} trainingInfo={this.state.trainingInfo} updateModelInfo={this.updateModelInfo} selected={this.state.selected} models={this.state.models} update={(name, value, canTuple, floatOkay=false) => this.updateParameters(this.state.selected, name, value, canTuple, floatOkay)} setEditableSelected={this.setEditableSelected}/>\r\n          </div>\r\n          \r\n        </div>\r\n      </React.Fragment>\r\n      \r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import {BASE_URL} from \"./Constants.js\";\r\n\r\n// functions to communicate with the server\r\n\r\nexport function getModel(modelID) {\r\n  /* get a model given its id from the server */\r\n  return fetch(BASE_URL+\"Architecture?id=\"+modelID).then(response => { \r\n    if (response.status === 200 || response.status === 404 || response.status === 400) {\r\n      return response.json();\r\n    }\r\n    throw new Error(\"Something went wrong when getting model\");\r\n  }).then(json => {\r\n    if ('message' in json) {\r\n      throw new Error(json['message']);\r\n    }\r\n    return json.data['modelJSON'];\r\n  })\r\n}\r\n\r\nexport function saveModel(serializedModel) {\r\n  /* save the serialized model to the server and returns its id */\r\n  return fetch(BASE_URL+'Architecture', {\r\n    method: 'POST',\r\n    headers: {\r\n      'Accept': 'application/json',\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: serializedModel,\r\n  }).then(response => {\r\n    if (response.status === 201) {\r\n      return response.json();\r\n    } else {\r\n      throw new Error(\"Something went wrong\");\r\n    }\r\n  })\r\n}\r\n\r\nexport function startSession(id) {\r\n  /* start a new training session given the model id */\r\n  return fetch(BASE_URL+\"Train\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      'Accept': 'application/json',\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({id:id}),\r\n  }).then(response => {\r\n    if (response.status === 201) {\r\n      return response.json();\r\n    }\r\n    throw new Error(\"Internal error\");\r\n  });\r\n}\r\n\r\nexport function updateTrain(sessionID) {\r\n  /* get the latest training status of a training session */\r\n  return fetch(BASE_URL+\"Train?id=\"+sessionID).then(response => {\r\n    if (response.status === 200) {\r\n      return response.json();\r\n    }\r\n    throw new Error(\"Training session failed to be fetched\");\r\n  })\r\n}\r\n\r\nexport function deleteTrain(sessionID) {\r\n  /* delete the training session given its session id */\r\n  return fetch(BASE_URL+\"Train\", {\r\n    method: \"DELETE\",\r\n    body: JSON.stringify({id:sessionID}),\r\n  });\r\n}\r\n\r\nexport function generateLink(id) {\r\n  /* generate a link for a saved model at the server */\r\n  return fetch(BASE_URL+\"Link\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      'Accept': 'application/json',\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({modelID: id})\r\n  }).then(response => {\r\n    if (response.status === 201) {\r\n      return response.json();\r\n    }\r\n    throw new Error(\"Failed to generate link\");\r\n  })\r\n}\r\n\r\nexport function getIDFromLink(link) {\r\n  /* get the corresponding model ID from the link */\r\n  return fetch(BASE_URL+\"Link?link=\"+link).then(response => {\r\n    if (response.status === 200 || response.status === 404 || response.status === 400)\r\n      return response.json();\r\n    throw new Error(\"Something went wrong with retrieving ID from link\");\r\n  }).then(json => {\r\n    if ('message' in json) {\r\n      throw new Error(json['message']);\r\n    }\r\n    return json['id'];\r\n  })\r\n}\r\n\r\nexport function downloadModel(modelID) {\r\n  /* get the json download for the model from its model ID */\r\n  return fetch(BASE_URL+\"Download?id=\"+modelID).then(response => {\r\n    if (response.status === 200 || response.status === 404 || response.status === 400)\r\n      return response.json();\r\n    throw new Error(\"Something went wrong with downloading the model\");\r\n  }).then(json => {\r\n    if ('message' in json) {\r\n      throw new Error(json['message']);\r\n    }\r\n    return json['data'];\r\n  })\r\n}\r\n\r\nexport function loadInput(url, name, inputShape, outputShape) {\r\n  /* load the custom input from the server */\r\n  return fetch(BASE_URL+\"Dataset\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      'Accept': 'application/json',\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({\r\n      link: url,\r\n      datasetName: name,\r\n      inputShape: String(inputShape),\r\n      outputShape: String(outputShape),\r\n    })\r\n  }).then(response => {\r\n    if (response.status === 201 || response.status === 404 || response.status === 400) \r\n      return response.json();\r\n    throw new Error(\"Something went wrong when loading the input\");\r\n  }).then(json => {\r\n    console.log(json);\r\n    if ('message' in json) {\r\n      throw new Error(json['message']);\r\n    }\r\n    return json['data'];\r\n  });\r\n}","import ReactDOM from 'react-dom';\r\nimport React from 'react';\r\nimport App from './App.js';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport \"./index.css\";\r\n\r\n// the main page being loaded here: entry point\r\n// for the app\r\n\r\nReactDOM.render(\r\n  <App />,\r\n  document.getElementById('root')\r\n);"],"sourceRoot":""}