(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(e,t,a){e.exports=a(314)},144:function(e,t,a){},146:function(e,t,a){},147:function(e,t,a){},148:function(e,t,a){},149:function(e,t,a){},150:function(e,t,a){},151:function(e,t,a){},152:function(e,t,a){},156:function(e,t){},158:function(e,t){},190:function(e,t){},191:function(e,t){},237:function(e,t){},238:function(e,t){},239:function(e,t){},240:function(e,t){},311:function(e,t,a){},313:function(e,t,a){},314:function(e,t,a){"use strict";a.r(t);var n=a(51),r=a.n(n),l=a(1),i=a.n(l),s=a(27),o=a.n(s),c=a(52),u=a(16),d=a(21),p=a(53),m=a(28),h=a(8),f=a(9),b=a(11),g=a(10),v=a(12),E=a(2),y=a(77),k=a.n(y),O=(a(144),a(24)),S=20,I="#cccccc";var j={dense:{name:"Dense",type:"layer",svg:function(e){var t,a=Object(u.a)(Array(3)).map(function(e,t){return i.a.createElement("circle",{cx:20,cy:24*(t+.5)+4,key:t,r:80/3/2-4,fill:"#83a5f7"})});return t=null!=e.activation?j[e.activation].svg(20,80+S/2+3):null,i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{width:40,height:80,fill:"#665cf9"}),i.a.createElement("rect",{width:40,y:80,height:S,fill:I}),a,t)},offsetX:20,offsetY:50,defaultParameters:{units:16},canActivation:!0,shapeOut:function(e,t,a){return null===t?null:[].concat(Object(u.a)(t.slice(0,t.length-1)),[e.units])}},conv:{name:"Conv",type:"layer",svg:function(e){var t;return t=null!=e.activation?j[e.activation].svg(40,60+S/2+3):null,i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{width:40,height:40,fill:"#2775f4"}),i.a.createElement("rect",{x:10,y:10,width:40,height:40,fill:"#4286f4"}),i.a.createElement("rect",{x:20,y:20,width:40,height:40,fill:"#5c98f9"}),i.a.createElement("rect",{x:20,y:60,width:40,height:S,fill:I}),t)},offsetX:40,offsetY:40,defaultParameters:{filters:8,kernelSize:[3,3],stride:1},canActivation:!0,shapeOut:function(e,t,a){if(null===t)return null;var n=t[0],r=t.slice(1,t.length-1),l=Object(O.isArray)(e.kernelSize)?e.kernelSize:[e.kernelSize],i="number"===typeof e.stride?Array(l.length).fill(e.stride):e.stride,s=e.filters;if(r.length!==l.length)return a("Kernel must have the same ndim as the input dimension (without batchSize)",!1),null;var o=r.map(function(e,t){return Math.floor((e-l[t])/i[t])+1});return[n].concat(Object(u.a)(o),[s])}},input:{name:"Input",type:"layer",svg:function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{width:30,height:30,fill:"#99ccff"}))},offsetX:15,offsetY:15,defaultParameters:{data:"MNIST",datasetID:"",inputShape:[28,28,1]},canActivation:!1,shapeOut:function(e,t,a){return null===e.inputShape?null:Object(O.isArray)(e.inputShape)?[Number(t.batchSize)].concat(Object(u.a)(e.inputShape)):[Number(t.batchSize),e.inputShape]}},maxpool:{name:"Max Pool",type:"layer",svg:function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{width:30,height:30,fill:"#be41f4"}),i.a.createElement("rect",{x:7.5,y:7.5,width:30,height:30,fill:"#e541f4"}),i.a.createElement("rect",{x:15,y:15,width:30,height:30,fill:"#f95cf9"}))},offsetX:30,offsetY:30,defaultParameters:{poolSize:[2,2]},canActivation:!1,shapeOut:function(e,t,a){if(null===t)return null;var n=t[0],r=t.slice(1,t.length-1),l=t[t.length-1],i="number"===typeof e.poolSize?[e.poolSize]:e.poolSize;if(r.length!==i.length)return a("PoolSize must have the same ndim as the input dimension (without batchSize)",!1),null;var s=r.map(function(e,t){return Math.floor(e/i[t])});return[n].concat(Object(u.a)(s),[l])}},embedding:{name:"Embedding",type:"layer",svg:function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{width:60,height:15,fill:"#6a41f4"}),i.a.createElement("rect",{width:30,height:15,y:15,fill:"#8a61ff"}),i.a.createElement("rect",{width:50,height:15,y:30,fill:"#7a51f5"}))},offsetX:25,offsetY:20,defaultParameters:{units:100},canActivation:!1,shapeOut:function(e,t,a){return null===t?null:Object(O.isNumber)(t)||2!==t.length?(a("Embedding input shape must be (batchSize, sequenceLength)",!1),null):[t[0],t[1],e.units]}},dropout:{name:"Dropout",type:"layer",svg:function(e){var t="#404040";return i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{width:10,height:10,x:0,y:0,fill:t}),i.a.createElement("rect",{width:10,height:10,x:20,y:0,fill:t}),i.a.createElement("rect",{width:10,height:10,x:30,y:0,fill:t}),i.a.createElement("rect",{width:10,height:10,x:10,y:10,fill:t}),i.a.createElement("rect",{width:10,height:10,x:20,y:10,fill:t}),i.a.createElement("rect",{width:10,height:10,x:0,y:20,fill:t}),i.a.createElement("rect",{width:10,height:10,x:20,y:20,fill:t}),i.a.createElement("rect",{width:10,height:10,x:30,y:20,fill:t}),i.a.createElement("rect",{width:10,height:10,x:10,y:30,fill:t}),i.a.createElement("rect",{width:10,height:10,x:20,y:30,fill:t}),i.a.createElement("rect",{width:10,height:10,x:30,y:30,fill:t}))},offsetX:20,offsetY:20,defaultParameters:{rate:.25},canActivation:!1,shapeOut:function(e,t,a){return null===t?null:t}},flatten:{name:"Flatten",type:"layer",svg:function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{width:16,height:120,fill:"#404040"}))},offsetX:8,offsetY:60,defaultParameters:{},canActivation:!1,shapeOut:function(e,t,a){return null===t?null:Object(O.isNumber)(t)||t.length<=2?(a("Flatten input shape must be (batchSize, ...shape) (ndim > 2)",!1),null):[t[0],t.slice(1).reduce(function(e,t){return e*t})]}},output:{name:"Output",type:"layer",svg:function(e){var t;return t=null!=e.activation?j[e.activation].svg(15,60+S/2+3):null,i.a.createElement(i.a.Fragment,null,i.a.createElement("rect",{width:30,height:60,fill:"#008066"}),i.a.createElement("rect",{width:30,y:60,height:S,fill:I}),t)},offsetX:10,offsetY:40,defaultParameters:{data:"MNIST",outputShape:[10]},canActivation:!0,shapeOut:function(e,t,a){return null===t?null:((Object(O.isNumber)(t)||2!==t.length)&&a("Output layer must have input layer of shape (batchSize, dim)",!1),Object(O.isArray)(e.outputShape)?[].concat(Object(u.a)(t.slice(0,t.length-1)),Object(u.a)(e.outputShape)):[].concat(Object(u.a)(t.slice(0,t.length-1)),[e.outputShape]))}},relu:{name:"ReLU",type:"activation",svg:function(e,t){return i.a.createElement(i.a.Fragment,null,i.a.createElement("path",{d:"M"+(e-12)+" "+t+"l12 0 l12 -8",stroke:"black",strokeWidth:"2",fill:"none"}))},defaultParameters:{}},sigmoid:{name:"Sigmoid",type:"activation",svg:function(e,t){return i.a.createElement("path",{d:"M "+(e-12)+" "+t+" q 11 0 12 "+-4+" q 1 "+-4+" 12 "+-4,stroke:"black",strokeWidth:"2",fill:"none"})},defaultParameters:{}},tanh:{name:"Tanh",type:"activation",svg:function(e,t){return i.a.createElement("path",{d:"M "+(e-12)+" "+t+" q 7 0 12 "+-4+" q 5 "+-4+" 12 "+-4,stroke:"black",strokeWidth:"2",fill:"none"})},defaultParameters:{}},softmax:{name:"SoftMax",type:"activation",svg:function(e,t){return i.a.createElement("path",{d:"M "+(e-12)+" "+t+" q 23 0 24 "+-8,stroke:"black",strokeWidth:"2",fill:"none"})},defaultParameters:{}}},N=["dense","conv","maxpool","flatten","embedding","dropout"],w=["relu","sigmoid","softmax","tanh"],C=JSON.parse('{"model":{"0":{"name":"input0","ID":0,"type":"input","x":20,"y":50,"connectedTo":null,"shapeIn":[25,28,28,1],"shapeOut":[25,28,28,1],"activation":null,"parameters":{"data":"MNIST","datasetID":"","inputShape":[28,28,1]}},"1":{"name":"output1","ID":1,"type":"output","x":300,"y":50,"connectedTo":null,"shapeIn":null,"shapeOut":null,"activation":null,"parameters":{"data":"MNIST","outputShape":[10]}}},"modelInfo":{"epochs":"2","batchSize":"25","maxToken":null,"loss":"cce","optimizer":"adam","learningRate":"0.01"}}'),M=JSON.parse('{"model":{"0":{"name":"input0","ID":0,"type":"input","x":20,"y":50,"connectedTo":4,"shapeIn":[25,28,28,1],"shapeOut":[25,28,28,1],"activation":null,"parameters":{"data":"MNIST","datasetID":"","inputShape":[28,28,1]}},"1":{"name":"output1","ID":1,"type":"output","x":300,"y":50,"connectedTo":null,"shapeIn":[25,288],"shapeOut":[25,10],"activation":"softmax","parameters":{"data":"MNIST","outputShape":[10]}},"4":{"name":"conv4","ID":4,"type":"conv","x":93.22129625745828,"y":45.02453806961887,"connectedTo":5,"shapeIn":[25,28,28,1],"shapeOut":[25,13,13,8],"activation":"relu","parameters":{"filters":8,"kernelSize":[3,3],"stride":2}},"5":{"name":"maxpool5","ID":5,"type":"maxpool","x":164.94433122077317,"y":50.04710123987789,"connectedTo":6,"shapeIn":[25,13,13,8],"shapeOut":[25,6,6,8],"activation":null,"parameters":{"poolSize":[2,2]}},"6":{"name":"flatten6","ID":6,"type":"flatten","x":227.27825598586503,"y":17.505554649411522,"connectedTo":1,"shapeIn":[25,6,6,8],"shapeOut":[25,288],"activation":null,"parameters":{}}},"modelInfo":{"epochs":"2","batchSize":"25","maxToken":null,"loss":"cce","optimizer":"adam","learningRate":"0.01"}}'),x=JSON.parse('{"model":{"0":{"name":"input0","ID":0,"type":"input","x":18,"y":50,"connectedTo":5,"shapeIn":[25,28,28,1],"shapeOut":[25,28,28,1],"activation":null,"parameters":{"data":"MNIST","datasetID":"","inputShape":[28,28,1]}},"1":{"name":"output1","ID":1,"type":"output","x":288,"y":50,"connectedTo":null,"shapeIn":[25,128],"shapeOut":[25,10],"activation":"softmax","parameters":{"data":"MNIST","outputShape":[10]}},"3":{"name":"flatten3","ID":3,"type":"flatten","x":153.95333629131653,"y":24.011553705551506,"connectedTo":4,"shapeIn":[25,28,28,16],"shapeOut":[25,12544],"activation":null,"parameters":{}},"4":{"name":"dense4","ID":4,"type":"dense","x":207.20185248114421,"y":39.051709968596924,"connectedTo":1,"shapeIn":[25,12544],"shapeOut":[25,128],"activation":"relu","parameters":{"units":128}},"5":{"name":"dense5","ID":5,"type":"dense","x":65.63926455425138,"y":26.941127293205966,"connectedTo":3,"shapeIn":[25,28,28,1],"shapeOut":[25,28,28,16],"activation":"relu","parameters":{"units":16}}},"modelInfo":{"epochs":"2","batchSize":"25","maxToken":1000,"loss":"cce","optimizer":"sgd","learningRate":"0.01"}}');function D(e){return i.a.createElement("div",{className:"sidebar-header"},i.a.createElement("button",{type:"button",className:"edit"===e.tabSelected?"btn btn-dark btn-block":"btn btn-outline-dark btn-block",onClick:function(){return e.changeTab("edit")}},"Edit"),i.a.createElement("button",{type:"button",className:"train"===e.tabSelected?"btn btn-dark btn-block":"btn btn-outline-dark btn-block",onClick:function(){return e.changeTab("train")}},"Train"))}function T(){return i.a.createElement("ul",{className:"list-unstyled CTAs"},i.a.createElement("li",null,i.a.createElement("a",{href:"https://www.github.com/alexding123/NN-Flowchart",className:"download"},"Download source")))}function L(e){return i.a.createElement("div",{className:"p-2 align-self-stretch button-container"},i.a.createElement("button",{className:"btn btn-sm btn-dark btn-block",onClick:e.onClick,disabled:e.disabled},e.children))}function z(e){return i.a.createElement(L,{onClick:function(){return e.newModel(e.name)}},j[e.name].name)}function P(e){return i.a.createElement(L,{onClick:function(){return e.newActivation(e.name)}},j[e.name].name)}var A=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).props=e,a.propsOri=e.propsOri,a.setActivation=a.setActivation.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"setActivation",value:function(e){if(-1!==this.props.selected){var t=this.props.models[this.props.selected];j[t.type].canActivation&&(t.activation===e?this.props.update(this.props.selected,{activation:null}):this.props.update(this.props.selected,{activation:e}))}else this.props.setError("Select a layer to add the activation to first!",!0)}},{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement(k.a,{trigger:"Layers",triggerTagName:"p",id:"layers-toggle",triggerClassName:"trigger",triggerOpenedClassName:"trigger active",onOpen:function(){return e.propsOri.update("layers",!1)},onClose:function(){return e.propsOri.update("layers",!0)},open:!this.propsOri.layersCollapsed},i.a.createElement("div",{className:"d-flex flex-column"},N.map(function(t){return i.a.createElement(z,{key:t,name:t,newModel:e.props.newModel})}))),i.a.createElement(k.a,{trigger:"Activations",triggerTagName:"p",triggerClassName:"trigger",triggerOpenedClassName:"trigger active",onOpen:function(){return e.propsOri.update("activations",!1)},onClose:function(){return e.propsOri.update("activations",!0)},open:!this.propsOri.activationsCollapsed},i.a.createElement("div",{className:"d-flex flex-column"},w.map(function(t){return i.a.createElement(P,{key:t,name:t,newActivation:function(){return e.setActivation(t)}})}))))}}]),t}(i.a.Component);function F(e){var t=e.props,a="Edit"!==t.trainingInfo.status,n=a?i.a.createElement(L,{onClick:t.cancelTrain},"Cancel"):i.a.createElement(L,{onClick:t.trainCloud},"Train on Cloud");return i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Server"),i.a.createElement(L,{onClick:t.setSelectModelPage,disabled:a},"New/Load"),i.a.createElement(L,{onClick:t.getLink},"Generate Link"),i.a.createElement("p",null,"Model"),n,i.a.createElement(L,{onClick:t.downloadModel},"Download Model"),i.a.createElement("p",null,"Input"),i.a.createElement(L,{onClick:t.setInput},"Set Input"))}function B(e){var t=e.props,a="edit"===e.tabSelected?i.a.createElement(A,{propsOri:e,models:t.models,selected:t.selected,setError:t.setError,newModel:t.newModel,update:t.update}):i.a.createElement(F,{props:t});return i.a.createElement("ul",{className:"list-unstyled components"},a)}var Y=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).props=e,a.state={tabSelected:"edit",layersCollapsed:!1,activationsCollapsed:!1},a.changeTab=a.changeTab.bind(Object(E.a)(Object(E.a)(a))),a.set=a.set.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"set",value:function(e,t){"layers"===e?this.setState({layersCollapsed:t}):"activations"===e&&this.setState({activationsCollapsed:t})}},{key:"changeTab",value:function(e){this.setState({tabSelected:e})}},{key:"render",value:function(){return i.a.createElement("nav",{className:"p-2 h-100",id:"sidebar"},i.a.createElement(D,{tabSelected:this.state.tabSelected,changeTab:this.changeTab}),i.a.createElement(B,{tabSelected:this.state.tabSelected,layersCollapsed:this.state.layersCollapsed,activationsCollapsed:this.state.activationsCollapsed,update:this.set,props:this.props}),i.a.createElement(T,null))}}]),t}(i.a.Component),X=(a(146),function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).props=e,a.onMouseDown=a.onMouseDown.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"onMouseDown",value:function(e){var t=this.props.model;this.props.handleDrag(e.clientX,e.clientY,t.ID)}},{key:"render",value:function(){var e=this.props.model;return i.a.createElement("g",{className:this.props.selected?"selected":"",onMouseDown:this.onMouseDown,key:e.ID,transform:"translate("+String(e.x)+","+String(e.y)+")",style:{userSelect:"none"}},j[e.type].svg(e))}}]),t}(i.a.Component));function J(e){return i.a.createElement("defs",null,i.a.createElement("marker",{id:"dot",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"5",markerHeight:"5"},i.a.createElement("circle",{cx:"5",cy:"5",r:"3",fill:"black"})),i.a.createElement("marker",{id:"arrow",markerWidth:"4",markerHeight:"4",orient:"auto",refY:"2"},i.a.createElement("path",{d:"M0,0 L4,2 0,4"})))}function R(e){var t=e.tentative?"5,5":null,a=e.selected?"selected":null,n=e.tentative?null:e.onClick,r=e.tentative?"none":null;"pointerEvents"in e&&(r=e.pointerEvents);var l=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2;return i.a.createElement("path",{d:"M "+e.x1+" "+e.y1+" L "+l+" "+s+" L "+e.x2+" "+e.y2,onClick:n,className:a,pointerEvents:r,strokeDasharray:t,stroke:"black",strokeWidth:"3",markerStart:"url(#arrow)",markerMid:"url(#arrow)",markerEnd:"url(#dot)"})}var U="http://localhost:5000/api/",_={MNIST:{input:[28,28,1],output:[10]},IMDB:{input:[500],output:[2]}};function W(e){var t=j[e.type].offsetX,a=j[e.type].offsetY;return{x:e.x+t,y:e.y+a}}var q=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).props=e,a.state={isNewline:!1,xOffset:0,yOffset:0,x:0,y:0,id:-1,selectedLineFromTo:[-1,-1],dragging:-1,initX:0,initY:0,initModelX:0,initModelY:0},a.handleElementClick=a.handleElementClick.bind(Object(E.a)(Object(E.a)(a))),a.trackMouse=a.trackMouse.bind(Object(E.a)(Object(E.a)(a))),a.handleBGClick=a.handleBGClick.bind(Object(E.a)(Object(E.a)(a))),a.handleLineClick=a.handleLineClick.bind(Object(E.a)(Object(E.a)(a))),a.deleteSelection=a.deleteSelection.bind(Object(E.a)(Object(E.a)(a))),a.handleDrag=a.handleDrag.bind(Object(E.a)(Object(E.a)(a))),a.onMouseUp=a.onMouseUp.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=r.a.findDOMNode(this).getBoundingClientRect();this.setState({xOffset:e.x,yOffset:e.y}),document.addEventListener("keydown",this.deleteSelection)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.deleteSelection)}},{key:"deleteSelection",value:function(e){if(!this.props.editableSelected&&8===e.keyCode){if(-1!==this.props.selected){this.cancelNewline();var t=this.props.selected;if(0===t||1===t)return;return this.props.select(-1),void this.props.remove(t)}var a=this.state.selectedLineFromTo[0],n=this.state.selectedLineFromTo[1];if(-1!==a||-1!==n)return this.cancelNewline(),void this.props.update(a,{connectedTo:null})}}},{key:"startNewline",value:function(e){this.setState({isNewline:!0,id:e,selectedLineFromTo:[-1,-1]})}},{key:"cancelNewline",value:function(){this.setState({isNewline:!1,id:-1,selectedLineFromTo:[-1,-1]})}},{key:"trackMouse",value:function(e){if(this.setState({x:e.clientX-this.state.xOffset,y:e.clientY-this.state.yOffset}),-1!==this.state.dragging){var t=e.clientX+this.state.initModelX-this.state.initX,a=e.clientY+this.state.initModelY-this.state.initY;this.props.update(this.state.dragging,{x:t,y:a})}}},{key:"onMouseUp",value:function(e){if(-1!==this.state.dragging){var t=this.state.dragging,a=this.props.models[t];this.setState({dragging:-1});Math.abs(a.x-this.state.initModelX)+Math.abs(a.y-this.state.initModelY)<10&&(this.props.select(a.ID),this.handleElementClick(a.ID))}}},{key:"handleBGClick",value:function(e){if(e.target===this.refs.canvas)return this.props.select(-1),void this.cancelNewline()}},{key:"handleElementClick",value:function(e){if(this.state.isNewline)return this.state.id!==e&&(this.props.update(this.state.id,{connectedTo:e}),this.props.models[e].connectedTo===this.state.id&&this.props.update(e,{connectedTo:null})),void this.cancelNewline();this.startNewline(e)}},{key:"handleLineClick",value:function(e,t){this.setState({selectedLineFromTo:[e,t]}),this.props.select(-1)}},{key:"handleDrag",value:function(e,t,a){var n=this.props.models[a];this.setState({dragging:a,initX:e,initY:t,initModelX:n.x,initModelY:n.y}),this.props.select(n.ID)}},{key:"render",value:function(){var e=this,t=Object.entries(this.props.models).map(function(t){var a=Object(d.a)(t,2),n=(a[0],a[1]);return i.a.createElement(X,{key:n.ID,handleDrag:e.handleDrag,model:n,selected:e.props.selected===n.ID})}),a=null;if(this.state.isNewline){var n=W(this.props.models[this.state.id]);a=i.a.createElement(R,{tentative:!0,selected:!0,x1:n.x,y1:n.y,x2:this.state.x,y2:this.state.y})}var r=Object.entries(this.props.models).map(function(t){var a=Object(d.a)(t,2),n=a[0],r=a[1];if(null===r.connectedTo)return null;var l=e.props.models[r.connectedTo],s=W(r),o=W(l),c=e.state.selectedLineFromTo[0]===r.ID&&e.state.selectedLineFromTo[1]===l.ID;return i.a.createElement(R,{key:n,tentative:!1,selected:c,x1:s.x,y1:s.y,x2:o.x,y2:o.y,onClick:function(){return e.handleLineClick(r.ID,l.ID)}})});return i.a.createElement("svg",{onClick:this.handleBGClick,onMouseMove:this.trackMouse,onMouseUp:this.onMouseUp,id:"canvas",width:"100%",height:"60%",ref:"canvas"},i.a.createElement(J,null),i.a.createElement("rect",{width:"100%",height:"100%",fill:"#b477ec",pointerEvents:"none"}),t,r,a)}}]),t}(i.a.Component);function G(e){return i.a.createElement("svg",{width:"100%",height:"20%"},i.a.createElement("rect",{width:"100%",height:"100%",fill:"blueviolet"}))}function V(e){return i.a.createElement("div",{className:"p-2 flex-grow-1 canvas-container no-margin"},i.a.createElement(G,null),i.a.createElement(q,{models:e.models,editableSelected:e.editableSelected,selected:e.selected,select:e.select,update:e.update,remove:e.remove}),i.a.createElement(G,null))}a(147);function H(e){return i.a.createElement("div",{className:"parameter-line"},i.a.createElement("div",{className:"parameter-name"},e.name,":"),i.a.createElement("div",{className:"parameter-value"},e.value))}var K=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).props=e,a.state={valueChanged:!1,currentValue:null},a.onFocus=function(){return a.props.setEditableSelected(!0)},a.onChange=a.onChange.bind(Object(E.a)(Object(E.a)(a))),a.onBlur=function(e){a.setState({valueChanged:!1,currentValue:null}),a.props.setEditableSelected(!1),a.props.callback(a.props.paraName,e)},a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"onChange",value:function(e){var t=e.target.value;this.setState({valueChanged:!0,currentValue:t})}},{key:"render",value:function(){var e=this,t=this.props.parameters[this.props.paraName],a=this.state.valueChanged?this.state.currentValue:t;return i.a.createElement("div",{className:"parameter-line"},i.a.createElement("div",{className:"parameter-name"},this.props.name),i.a.createElement("input",{className:"parameter-input",onFocus:this.onFocus,onBlur:function(){return e.onBlur(a)},onChange:this.onChange,value:a}))}}]),t}(i.a.Component);function Q(e){return i.a.createElement("div",{className:"parameter-line"},i.a.createElement("div",{className:"parameter-name"},"Dataset"),i.a.createElement("div",{className:"parameter-input parameter-clickable",onClick:e.setInputDataset},e.value))}function Z(e){var t=e.model;if(null===t)return null;switch(t.type){case"dense":return i.a.createElement(i.a.Fragment,null,i.a.createElement(K,{name:"Units",paraName:"units",setEditableSelected:e.setEditableSelected,parameters:t.parameters,callback:function(t,a){return e.callback(t,a,!1)}}));case"conv":return i.a.createElement(i.a.Fragment,null,i.a.createElement(K,{name:"Filters",paraName:"filters",setEditableSelected:e.setEditableSelected,parameters:t.parameters,callback:function(t,a){return e.callback(t,a,!1)}}),i.a.createElement(K,{name:"Kernel Size",paraName:"kernelSize",setEditableSelected:e.setEditableSelected,parameters:t.parameters,callback:function(t,a){return e.callback(t,a,!0)}}),i.a.createElement(K,{name:"Stride",paraName:"stride",setEditableSelected:e.setEditableSelected,parameters:t.parameters,callback:function(t,a){return e.callback(t,a,!0)}}));case"input":return i.a.createElement(i.a.Fragment,null,i.a.createElement(Q,{value:t.parameters.data,setInputDataset:e.setInputDataset}));case"maxpool":return i.a.createElement(i.a.Fragment,null,i.a.createElement(K,{name:"Pool Size",paraName:"poolSize",setEditableSelected:e.setEditableSelected,parameters:t.parameters,callback:function(t,a){return e.callback(t,a,!0)}}));case"embedding":return i.a.createElement(i.a.Fragment,null,i.a.createElement(K,{name:"Units",paraName:"units",setEditableSelected:e.setEditableSelected,parameters:t.parameters,callback:function(t,a){return e.callback(t,a,!1)}}));case"dropout":return i.a.createElement(i.a.Fragment,null,i.a.createElement(K,{name:"Rate",paraName:"rate",setEditableSelected:e.setEditableSelected,parameters:t.parameters,callback:function(t,a){return e.callback(t,a,!1,!0)}}));default:return null}}function $(e){if(-1===e.selected){var t=e.modelInfo,a=e.trainingInfo,n=null===a.loss?"N/A":a.loss.toFixed(2),r=null===a.accuracy?"N/A":(100*a.accuracy).toFixed(2)+"%",l=null===a.testAccuracy?"N/A":(100*a.testAccuracy).toFixed(2)+"%",s=null===a.progress?"0.0%":(100*a.progress).toFixed(2)+"%";return i.a.createElement("nav",{className:"p-2 no-margin",id:"toolbar"},i.a.createElement("div",{id:"toolbar-container"},i.a.createElement("div",{className:"left-line"},i.a.createElement("p",null,"Model Information"),i.a.createElement(K,{name:"Epochs",paraName:"epochs",setEditableSelected:function(){return null},parameters:t,callback:function(t,a){return e.updateModelInfo(t,a,!0)}}),i.a.createElement(K,{name:"Batch Size",paraName:"batchSize",setEditableSelected:function(){return null},parameters:t,callback:function(t,a){return e.updateModelInfo(t,a,!0)}}),i.a.createElement("button",{onClick:e.trainSetup,className:"btn btn-sm btn-light btn-block"},"More")),i.a.createElement("div",{className:"blocker"}),i.a.createElement("div",{className:"middle-line"},i.a.createElement("p",null,"Train Information"),i.a.createElement(H,{name:"Status",value:a.status}),i.a.createElement(H,{name:"Progress",value:s})),i.a.createElement("div",{className:"blocker"}),i.a.createElement("div",{className:"right-line"},i.a.createElement("br",null),i.a.createElement(H,{name:"Accuracy",value:r}),i.a.createElement(H,{name:"Loss",value:n}),i.a.createElement(H,{name:"Test Acc",value:l}))))}var o=e.models[e.selected],c=j[o.type].name,u=null===o.activation?"None":j[o.activation].name,d=null===o.shapeIn?"N/A":String(o.shapeIn),p=null===o.shapeOut?"N/A":String(o.shapeOut);return i.a.createElement("nav",{className:"p-2 no-margin",id:"toolbar"},i.a.createElement("div",{id:"toolbar-container"},i.a.createElement("div",{className:"left-line"},i.a.createElement("p",null,"Parameters"),i.a.createElement(Z,{model:o,callback:e.update,setEditableSelected:e.setEditableSelected,setInputDataset:e.setInputDataset})),i.a.createElement("div",{className:"blocker"}),i.a.createElement("div",{className:"middle-line"},i.a.createElement("p",null,"Layer Information"),i.a.createElement(H,{name:"Type",value:c}),i.a.createElement(H,{name:"Activation",value:u})),i.a.createElement("div",{className:"blocker"}),i.a.createElement("div",{className:"right-line"},i.a.createElement("br",null),i.a.createElement(H,{name:"Shape In",value:d}),i.a.createElement(H,{name:"Shape Out",value:p}))))}a(148);function ee(e){return null===e.errorMsg?null:e.dismissible?i.a.createElement("div",{className:"position-absolute float-box"},i.a.createElement("div",{className:"alert alert-danger alert-dismissible position-absolute w-100"},i.a.createElement("strong",null,"Error:")," ",e.errorMsg,i.a.createElement("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(){return e.setError(null,!0)}},i.a.createElement("span",{"aria-hidden":"true"},"\xd7")))):i.a.createElement("div",{className:"position-absolute float-box"},i.a.createElement("div",{className:"alert alert-danger position-absolute w-100"},i.a.createElement("strong",null,"Error:")," ",e.errorMsg))}a(149);var te=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).props=e,a.state={err:null,link:null},a.onChange=a.onChange.bind(Object(E.a)(Object(E.a)(a))),a.noChange=a.noChange.bind(Object(E.a)(Object(E.a)(a))),a.loadModel=a.loadModel.bind(Object(E.a)(Object(E.a)(a))),a.setError=a.setError.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"setError",value:function(e){this.setState({err:e})}},{key:"loadModel",value:function(){this.props.loadModel(this.state.link,this.setError)}},{key:"onChange",value:function(e){this.setState({link:e.target.value})}},{key:"noChange",value:function(e){"background-model-select"!==e.target.id&&"model-blocker"!==e.target.id||this.props.toggle()}},{key:"render",value:function(){var e=this;return this.props.display?i.a.createElement("div",{id:"background-model-select",onClick:this.noChange,className:"select-model-container"},i.a.createElement("h1",null,"Load a Model"),i.a.createElement("div",{className:"model-container"},i.a.createElement("div",{className:"model-new"},i.a.createElement("h2",null,"New Model"),i.a.createElement("div",{className:"d-flex flex-wrap p-2"},i.a.createElement("div",{className:"p-2"},i.a.createElement("button",{type:"button",onClick:function(){return e.props.loadDefaultModel("blank")},className:"btn btn-secondary"},"Blank")),i.a.createElement("div",{className:"p-2"},i.a.createElement("button",{type:"button",onClick:function(){return e.props.loadDefaultModel("dense")},className:"btn btn-secondary"},"Dense")),i.a.createElement("div",{className:"p-2"},i.a.createElement("button",{type:"button",onClick:function(){return e.props.loadDefaultModel("conv")},className:"btn btn-secondary"},"Conv")))),i.a.createElement("div",{id:"model-blocker",className:"model-blocker"}),i.a.createElement("div",{className:"model-load"},i.a.createElement("h2",null,"Load Model"),i.a.createElement("label",null,"Model link"),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Enter model link",onChange:this.onChange}),i.a.createElement("small",{className:"form-text text-muted"},this.state.err),i.a.createElement("br",null),i.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.loadModel},"Load")))):null}}]),t}(i.a.Component);a(150);function ae(e){if(!e.display)return null;var t=document.createElement("textarea");return document.body.appendChild(t),t.value=e.link,t.select(),document.execCommand("copy"),document.body.removeChild(t),i.a.createElement("div",{onClick:function(t){"linkpage-container"!==t.target.id&&"linkpage-content"!==t.target.id||e.toggle()},className:"linkpage-container",id:"linkpage-container"},i.a.createElement("div",{className:"linkpage-content",id:"linkpage-content"},i.a.createElement("h1",null,"Model Link"),i.a.createElement("input",{readOnly:!0,className:"form-control",type:"text",value:e.link}),i.a.createElement("small",{className:"form-text text-muted"},"Link copied to clipboard")))}a(151);var ne=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).props=e,a.state={err:null,name:"",link:"",inputShape:[],outputShape:[],inputShapeDisplay:"",outputShapeDisplay:""},a.onChange=a.onChange.bind(Object(E.a)(Object(E.a)(a))),a.noChange=a.noChange.bind(Object(E.a)(Object(E.a)(a))),a.setError=a.setError.bind(Object(E.a)(Object(E.a)(a))),a.onChangeShapeInput=a.onChangeShapeInput.bind(Object(E.a)(Object(E.a)(a))),a.onChangeShapeOutput=a.onChangeShapeOutput.bind(Object(E.a)(Object(E.a)(a))),a.onChangeName=a.onChangeName.bind(Object(E.a)(Object(E.a)(a))),a.onBlurInput=a.onBlurInput.bind(Object(E.a)(Object(E.a)(a))),a.onBlurOutput=a.onBlurOutput.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"setError",value:function(e){this.setState({err:e})}},{key:"onChange",value:function(e){this.setState({link:e.target.value})}},{key:"breakShape",value:function(e){var t=String(e).split(",");if(0===t.length)return[];for(var a=0;a<t.length;a++){var n=parseInt(t[a]);if(isNaN(n))return null;t[a]=n}return t}},{key:"toString",value:function(e){return 0===e.length?"":e.join(",")}},{key:"onChangeShapeInput",value:function(e){this.setState({inputShapeDisplay:e.target.value})}},{key:"onBlurInput",value:function(e){var t=this.breakShape(e.target.value);null!==t?this.setState({inputShape:t,inputShapeDisplay:this.toString(t)}):this.setState({inputShapeDisplay:this.toString(this.state.inputShape)})}},{key:"onChangeShapeOutput",value:function(e){this.setState({outputShapeDisplay:e.target.value})}},{key:"onBlurOutput",value:function(e){var t=this.breakShape(e.target.value);null!==t?this.setState({outputShape:t,outputShapeDisplay:this.toString(t)}):this.setState({outputShapeDisplay:this.toString(this.state.outputShape)})}},{key:"onChangeName",value:function(e){this.setState({name:e.target.value})}},{key:"noChange",value:function(e){"background-input-set"!==e.target.id&&"input-blocker"!==e.target.id||this.props.toggle()}},{key:"render",value:function(){var e=this;return this.props.display?i.a.createElement("div",{id:"background-input-set",onClick:this.noChange,className:"set-input-container"},i.a.createElement("h1",null,"Load Input Dataset"),i.a.createElement("div",{className:"input-container"},i.a.createElement("div",{className:"input-preset"},i.a.createElement("h2",null,"Load Preset"),i.a.createElement("div",{className:"d-flex flex-wrap p-2"},i.a.createElement("div",{className:"p-2"},i.a.createElement("button",{type:"button",onClick:function(){return e.props.loadDefaultInput("MNIST")},className:"btn btn-secondary"},"MNIST")))),i.a.createElement("div",{id:"input-blocker",className:"input-blocker"}),i.a.createElement("div",{className:"input-load"},i.a.createElement("h2",null,"Load Custom Dataset (BROKEN)"),i.a.createElement("div",{className:"form-group"},i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Enter input URL",onChange:this.onChange,value:this.state.link})),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Name",onChange:this.onChangeName,value:this.state.name}),i.a.createElement("small",{className:"form-text"},"Shape does not include batchSize"),i.a.createElement("div",{className:"form-row"},i.a.createElement("div",{className:"col"},i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Input shape",onChange:this.onChangeShapeInput,onBlur:this.onBlurInput,value:this.state.inputShapeDisplay})),i.a.createElement("div",{className:"col"},i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Output shape",onChange:this.onChangeShapeOutput,onBlur:this.onBlurOutput,value:this.state.outputShapeDisplay}))),i.a.createElement("small",{className:"form-text text-muted"},this.state.err),i.a.createElement("br",null),i.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(){return e.props.loadInput(e.state.link,e.state.name,e.state.inputShape,e.state.outputShape,e.setError)}},"Load")))):null}}]),t}(i.a.Component);function re(e){for(var t={},a={},n=0,r=Object.keys(e);n<r.length;n++){var l=r[n];t[l]=!1,a[l]=!1}for(var i=0,s=Object.keys(e);i<s.length;i++){if(le(e,s[i],t,a))return!0}return!1}function le(e,t,a,n){if(a[t])return n[t]=!1,!1;if(a[t]=!0,n[t]=!0,null===e[t].connectedTo)return n[t]=!1,!1;var r=e[t].connectedTo;return!(a[r]||!le(e,r,a,n))||(!!n[r]||(n[t]=!1,!1))}function ie(e){for(var t={},a=0,n=Object.keys(e);a<n.length;a++){t[n[a]]=0}for(var r=0,l=Object.keys(e);r<l.length;r++){var i=e[l[r]].connectedTo;null!==i&&(t[i]+=1)}if(0!==t[0])return{ok:!1,err:"Input node cannot have incoming edge"};if(null!==e[1].connectedTo)return{ok:!1,err:"Output node cannot have outgoing edge"};for(var s=0,o=Object.keys(e);s<o.length;s++){if(t[o[s]]>1)return{ok:!1,err:"No node can have more than one incoming edge"}}return{ok:!0,err:""}}function se(e){var t=ie(e);if(!t.ok)return t;if(re(e))return{ok:!1,err:"Model cannot be cyclic"};if(null===e[1].shapeIn||2!==e[1].shapeOut.length)return{ok:!1,err:"Output node must have shape (batchSize, categories)"};for(var a=e[0];1!==a.ID;){if(null===a.connectedTo)return{ok:!1,err:"Model does not connect from input node to output node"};a=e[a.connectedTo]}return{ok:!0,err:""}}a(152);function oe(e){var t=e.selected===e.name?"btn btn-info":"btn btn-secondary";return i.a.createElement("div",{className:"p-2"},i.a.createElement("button",{type:"button",onClick:function(){return e.select(e.name)},className:t},e.displayName))}var ce=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).props=e,a.onClick=a.onClick.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"onClick",value:function(e){"background-input-set"===e.target.id&&this.props.toggle()}},{key:"render",value:function(){var e=this;return this.props.display?i.a.createElement("div",{id:"background-input-set",className:"set-input-container",onClick:this.onClick},i.a.createElement("h1",null,"Setup Training Details"),i.a.createElement("div",{className:"input-container"},i.a.createElement("div",{className:"input-preset"},i.a.createElement("h2",null,"Optimizer"),i.a.createElement("div",null,"Learning Rate: ",i.a.createElement("input",{id:"learning-rate",type:"number",step:"any",value:this.props.modelInfo.learningRate,onChange:function(){return e.props.update("learningRate",parseFloat(document.getElementById("learning-rate").value))},min:"0"})),i.a.createElement("div",{className:"d-flex flex-wrap p-2"},i.a.createElement(oe,{name:"adam",displayName:"Adam",selected:this.props.modelInfo.optimizer,select:function(t){return e.props.update("optimizer",t)}}),i.a.createElement(oe,{name:"sgd",displayName:"SGD",selected:this.props.modelInfo.optimizer,select:function(t){return e.props.update("optimizer",t)}}),i.a.createElement(oe,{name:"rmsProp",displayName:"RMS Prop",selected:this.props.modelInfo.optimizer,select:function(t){return e.props.update("optimizer",t)}}))),i.a.createElement("div",{id:"input-blocker",className:"input-blocker"}),i.a.createElement("div",{className:"input-load"},i.a.createElement("h2",null,"Loss"),i.a.createElement("div",{className:"d-flex flex-wrap p-2"},i.a.createElement(oe,{name:"mse",displayName:"Mean Squared Error",selected:this.props.modelInfo.loss,select:function(t){return e.props.update("loss",t)}}),i.a.createElement(oe,{name:"logcosh",displayName:"Log Cosh",selected:this.props.modelInfo.loss,select:function(t){return e.props.update("loss",t)}}),i.a.createElement(oe,{name:"cce",displayName:"Categorical Crossentropy",selected:this.props.modelInfo.loss,select:function(t){return e.props.update("loss",t)}}))))):null}}]),t}(i.a.Component),ue=a(5);function de(e,t){var a=function(e,t){var a={};Object.keys(e).map(function(n,r){var l=e[n];return a[n]=function(e,t){var a=function(e){var t=null,a=e.shapeIn.slice(1,e.shapeIn.length-1);switch(e.type){case"input":t=ue.a.inputLayer;break;case"output":case"dense":t=ue.a.dense;break;case"conv":1===a.length?t=ue.a.conv1d:2===a.length&&(t=ue.a.conv2d);break;case"maxpool":1===a.length?t=ue.a.maxPooling1d:2===a.length&&(t=ue.a.maxPooling2d);break;case"flatten":t=ue.a.flatten;break;case"embedding":t=ue.a.embedding;break;case"dropout":t=ue.a.dropout}return t}(e),n=JSON.parse(JSON.stringify(e.parameters));n.activation=e.activation,"input"===e.type?n.inputShape=e.shapeIn.slice(1):"output"===e.type?n.units=e.shapeOut.slice(1)[0]:"embedding"===e.type&&(n.inputDim=t.maxToken,n.outputDim=n.units);return a(n)}(l,t),null});var n=ue.c(),r=0;do{n.add(a[r]),r=e[r].connectedTo}while("output"!==e[r].type);return n.add(a[r]),n}(e,t),n=function(e){var t=null;switch(e.optimizer){case"adam":t=ue.f.adam;break;case"sgd":t=ue.f.sgd;break;case"rmsprop":t=ue.f.rmsprop}return t(e.learningRate)}(t),r=function(e){var t=null;switch(e){case"mse":t=ue.b.meanSquaredError;break;case"logcosh":t="logcosh";break;case"cce":t="categoricalCrossentropy"}return t}(t.loss);return a.compile({optimizer:n,loss:r,metrics:["acc"]}),a}var pe=function(){function e(){Object(h.a)(this,e)}return Object(f.a)(e,[{key:"load",value:function(){var e=Object(c.a)(o.a.mark(function e(){var t,a,n,r,l,i,s,c,u=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Image,a=document.createElement("canvas"),n=a.getContext("2d"),r=new Promise(function(e,r){t.crossOrigin="",t.onload=function(){t.width=t.naturalWidth,t.height=t.naturalHeight;var r=new ArrayBuffer(20384e4);a.width=t.width,a.height=5e3;for(var l=0;l<13;l++){var i=new Float32Array(r,784*l*5e3*4,392e4);n.drawImage(t,0,5e3*l,t.width,5e3,0,0,t.width,5e3);for(var s=n.getImageData(0,0,a.width,a.height),o=0;o<s.data.length/4;o++)i[o]=s.data[4*o]/255}u.datasetImages=new Float32Array(r),e()},t.src="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png"}),l=fetch("https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"),e.next=7,Promise.all([r,l]);case 7:return i=e.sent,s=Object(d.a)(i,2),s[0],c=s[1],e.t0=Uint8Array,e.next=14,c.arrayBuffer();case 14:e.t1=e.sent,this.datasetLabels=new e.t0(e.t1),this.trainImages=this.datasetImages.slice(0,4312e4),this.testImages=this.datasetImages.slice(4312e4),this.trainLabels=this.datasetLabels.slice(0,55e4),this.testLabels=this.datasetLabels.slice(55e4);case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTrainData",value:function(e){var t=ue.e(this.trainImages,[this.trainImages.length/784,28,28,1]),a=ue.d(this.trainLabels,[this.trainLabels.length/10,10]);return null!=e&&(t=t.slice([0,0,0,0],[e,28,28,1]),a=a.slice([0,0],[e,10])),[t,a]}},{key:"getTestData",value:function(e){var t=ue.e(this.testImages,[this.testImages.length/784,28,28,1]),a=ue.d(this.testLabels,[this.testLabels.length/10,10]);return null!=e&&(t=t.slice([0,0,0,0],[e,28,28,1]),a=a.slice([0,0],[e,10])),[t,a]}}]),e}(),me=a(133),he=a.n(me),fe=(a(311),function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(g.a)(t).call(this,e))).state={models:{0:a._model("input",0,20,50),1:a._model("output",1,300,50)},modelInfo:{epochs:"2",batchSize:"25",maxToken:null,loss:"cce",optimizer:"adam",learningRate:"0.01"},selected:0,nextID:2,errorMsg:null,errorOnce:!1,trainingInfo:{accuracy:null,testAccuracy:null,loss:null,progress:null,status:"Edit",currentEpoch:0,correct:0,total:0,batchesPerEpoch:null},editableSelected:!1,selectModelPage:!0,linkPage:!1,link:null,settingInput:!1,trainSetup:!1},a.newModel=a.newModel.bind(Object(E.a)(Object(E.a)(a))),a.updateModel=a.updateModel.bind(Object(E.a)(Object(E.a)(a))),a.selectModel=a.selectModel.bind(Object(E.a)(Object(E.a)(a))),a.removeModel=a.removeModel.bind(Object(E.a)(Object(E.a)(a))),a.setEditableSelected=a.setEditableSelected.bind(Object(E.a)(Object(E.a)(a))),a.updateModelInfo=a.updateModelInfo.bind(Object(E.a)(Object(E.a)(a))),a.setError=a.setError.bind(Object(E.a)(Object(E.a)(a))),a.trainCloud=a.trainCloud.bind(Object(E.a)(Object(E.a)(a))),a.startSession=a.startSession.bind(Object(E.a)(Object(E.a)(a))),a.endSession=a.endSession.bind(Object(E.a)(Object(E.a)(a))),a.updateTrain=a.updateTrain.bind(Object(E.a)(Object(E.a)(a))),a.cancelTrain=a.cancelTrain.bind(Object(E.a)(Object(E.a)(a))),a.state.models=a._updateDependents(a.state.models),a.loadDefaultModel=a.loadDefaultModel.bind(Object(E.a)(Object(E.a)(a))),a.loadModel=a.loadModel.bind(Object(E.a)(Object(E.a)(a))),a.downloadModel=a.downloadModel.bind(Object(E.a)(Object(E.a)(a))),a.getLink=a.getLink.bind(Object(E.a)(Object(E.a)(a))),a.setInput=a.setInput.bind(Object(E.a)(Object(E.a)(a))),a.loadDefaultInput=a.loadDefaultInput.bind(Object(E.a)(Object(E.a)(a))),a.loadCustomInput=a.loadCustomInput.bind(Object(E.a)(Object(E.a)(a))),a.trainSetup=a.trainSetup.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(f.a)(t,[{key:"_model",value:function(e,t,a,n){return{name:e+String(t),ID:t,type:e,x:a,y:n,connectedTo:null,shapeIn:null,shapeOut:null,activation:null,parameters:he()(j[e].defaultParameters)}}},{key:"model",value:function(e){return this._model(e,this.state.nextID,10+80*Math.random(),10+80*Math.random())}},{key:"updateDependents",value:function(e){return this.setError(null,!1),this._updateDependents(e)}},{key:"_updateDependents",value:function(e){var t=e[0];t.shapeOut=j[t.type].shapeOut(t.parameters,this.state.modelInfo,this.setError),t.shapeIn=t.shapeOut;for(var a=t,n=e[t.connectedTo];null!==a.connectedTo;)n.shapeIn=a.shapeOut,"input"===n.type?n.shapeOut=j[n.type].shapeOut(n.parameters,this.state.modelInfo,this.setError):n.shapeOut=j[n.type].shapeOut(n.parameters,n.shapeIn,this.setError),a=n,n=e[n.connectedTo];return e}},{key:"newModel",value:function(e){var t=Object(m.a)({},this.state.models),a=Object(m.a)({},t,Object(p.a)({},this.state.nextID,this.model(e)));a=this.updateDependents(a),this.setState({models:a,nextID:this.state.nextID+1})}},{key:"selectModel",value:function(e){this.setState({selected:e})}},{key:"updateModel",value:function(e,t){for(var a=Object(m.a)({},this.state.models),n=0,r=Object.keys(t);n<r.length;n++){var l=r[n];a[e][l]=t[l]}re(a)?this.setError("Graph cannot have loops",!1):ie(a).ok?(this.setError(null,!1),a=this.updateDependents(a),this.setState({models:a})):this.setError(ie(a).err,!1)}},{key:"removeModel",value:function(e){for(var t={},a=0,n=Object.keys(this.state.models);a<n.length;a++){var r=n[a];this.state.models[r].ID!==e&&(t[r]=this.state.models[r])}for(var l=0,i=Object.keys(t);l<i.length;l++){var s=i[l];t[s].connectedTo===e&&(t[s].connectedTo=null)}t=this.updateDependents(t),this.setState({models:t})}},{key:"updateParameters",value:function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=Object(m.a)({},this.state.models[e]),i=String(a).split(",");if(0!==i.length){for(var s=0;s<i.length;s++){var o=r?parseFloat(i[s]):parseInt(i[s]);if(isNaN(o))return;i[s]=o}if(i.length>1){if(!n)return;l.parameters[t]=i}else l.parameters[t]=i[0];var c=Object(m.a)({},this.state.models);c[e]=l,c=this.updateDependents(c),this.setState({models:c})}}},{key:"updateModelInfo",value:function(e,t){if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])||!isNaN(t)&&""!==t){var a=this.state.modelInfo;a[e]=t,this.setState({modelInfo:a})}}},{key:"setError",value:function(e,t){if(t)this.setState({errorMsg:e,errorOnce:t});else{if(this.state.errorOnce&&null!==this.state.errorMsg)return;this.setState({errorMsg:e,errorOnce:t})}}},{key:"setEditableSelected",value:function(e){this.setState({editableSelected:e})}},{key:"trainCloud",value:function(){var e=this.updateDependents(this.state.models);this.setState({models:e});var t=se(e);if(t.ok){var a=de(this.state.models,this.state.modelInfo);this.startSession(a)}else this.setError(t.err,!0)}},{key:"startSession",value:function(e){var t=this,a=this.state.trainingInfo;a.status="Loading...",this.setState({trainingInfo:a});var n=new pe,r=this.updateTrain,l=this.endSession;n.load().then(function(){var i=n.getTrainData(1e4),s=Object(d.a)(i,2),o=s[0],c=s[1];a.status="Training",a.batchesPerEpoch=Math.floor(o.shape[0]/t.state.modelInfo.batchSize),a.currentEpoch=-1,t.setState({trainingInfo:a}),e.fit(o,c,{epochs:parseInt(t.state.modelInfo.epochs),batchSize:parseInt(t.state.modelInfo.batchSize),callbacks:{onBatchEnd:function(t,a){return r(e,t,a)},onTrainEnd:function(t){return l(e,n)}},validationSplit:.1})}),this.selectModel(-1)}},{key:"updateTrain",value:function(e,t,a){if("Edit"!==this.state.trainingInfo.status){var n=this.state.trainingInfo;0===t&&(n.currentEpoch+=1,n.correct=0,n.total=0);var r=parseInt(this.state.modelInfo.batchSize),l=this.state.modelInfo.epochs,i=this.state.trainingInfo.batchesPerEpoch,s=n.currentEpoch,o=a.acc*r;n.correct+=o,n.total+=r,n.accuracy=n.correct/n.total,n.loss=a.loss,n.progress=s/l+t/i/l,this.setState({trainingInfo:n})}else e.stopTraining=!0}},{key:"endSession",value:function(e,t){var a=this.state.trainingInfo;a.progress=1,a.currentEpoch=0,a.status="Test",this.setState({trainingInfo:a});var n=t.getTestData(),r=Object(d.a)(n,2),l=r[0],i=r[1],s=e.evaluate(l,i)[1].as1D().dataSync()[0];a.testAccuracy=s,a.status="Edit",a.progress=0,this.setState({trainingInfo:a})}},{key:"cancelTrain",value:function(){var e=this.state.trainingInfo;e.status="Edit",this.setState({trainingInfo:e})}},{key:"loadModel",value:function(e,t){var a=this;(function(e){return fetch(U+"Link?link="+e).then(function(e){if(200===e.status||404===e.status||400===e.status)return e.json();throw new Error("Something went wrong with retrieving ID from link")}).then(function(e){if("message"in e)throw new Error(e.message);return e.id})})(e).then(function(e){(function(e){return fetch(U+"Architecture?id="+e).then(function(e){if(200===e.status||404===e.status||400===e.status)return e.json();throw new Error("Something went wrong when getting model")}).then(function(e){if("message"in e)throw new Error(e.message);return e.data.modelJSON})})(e).then(function(e){var n=JSON.parse(e),r=a.state.modelInfo;a.setState({modelInfo:r,models:n.model,nextID:Math.max.apply(Math,Object(u.a)(Object.keys(n.model).map(function(e){return Number(e)})))+1,selectModelPage:!1}),t(null)}).catch(function(e){t(e.message)})}).catch(function(e){t(e.message)})}},{key:"loadDefaultModel",value:function(e){var t=null;switch(e){case"blank":t=C;break;case"dense":t=x;break;case"conv":t=M;break;default:return}this.setState({nextID:Math.max.apply(Math,Object(u.a)(Object.keys(t.model).map(function(e){return Number(e)})))+1,models:t.model,modelInfo:t.modelInfo,selectModelPage:!1})}},{key:"getLink",value:function(){var e=this,t=this.updateDependents(this.state.models);this.setState({models:t}),function(e){return fetch(U+"Architecture",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:e}).then(function(e){if(201===e.status)return e.json();throw new Error("Something went wrong")})}(JSON.stringify({modelJSON:JSON.stringify({model:t,modelInfo:this.state.modelInfo})})).then(function(t){var a;(a=t.data.id,fetch(U+"Link",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({modelID:a})}).then(function(e){if(201===e.status)return e.json();throw new Error("Failed to generate link")})).then(function(t){var a=t.data.link;e.setState({link:a,linkPage:!0})}).catch(function(t){e.setError(t.message,!0)})}).catch(function(t){e.setError(t.message,!0)})}},{key:"downloadModel",value:function(){var e=Object(c.a)(o.a.mark(function e(){var t,a,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.updateDependents(this.state.models),this.setState({models:t}),(a=se(t)).ok){e.next=6;break}return this.setError(a.err,!0),e.abrupt("return");case 6:return n=de(t,this.state.modelInfo),e.next=9,n.save("downloads://tfjs-model");case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadDefaultInput",value:function(e){var t=this.state.models;t[0].parameters.data=e,t[0].parameters.inputShape=_[e].input,t[1].parameters.outputShape=_[e].output;var a=this.state.modelInfo;"IMDB"===e&&(a.maxToken=1e3),this.setState({models:this.updateDependents(t),settingInput:!1,modelInfo:a})}},{key:"loadCustomInput",value:function(e,t,a,n,r){var l=this;0!==a.length&&0!==n.length?null!==t?function(e,t,a,n){return fetch(U+"Dataset",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({link:e,datasetName:t,inputShape:String(a),outputShape:String(n)})}).then(function(e){if(201===e.status||404===e.status||400===e.status)return e.json();throw new Error("Something went wrong when loading the input")}).then(function(e){if(console.log(e),"message"in e)throw new Error(e.message);return e.data})}(e,t,a,n).catch(function(e){r(e.message)}).then(function(e){var t=l.state.models;t[0].parameters.data=e.datasetName,t[0].parameters.inputShape=JSON.parse(e.inputShape),t[0].parameters.datasetID=e.datasetID,t[1].parameters.data=e.datasetName,t[1].parameters.outputShape=JSON.parse(e.outputShape),t=l.updateDependents(t),l.setState({models:t,settingInput:!1})}):r("Name your dataset!"):r("Input and output shapes must be set")}},{key:"setInput",value:function(){this.setState({settingInput:!0})}},{key:"trainSetup",value:function(){this.setState({trainSetup:!0})}},{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement(ae,{display:this.state.linkPage,link:this.state.link,toggle:function(){return e.setState({linkPage:!1})}}),i.a.createElement(te,{display:this.state.selectModelPage,loadModel:this.loadModel,loadDefaultModel:this.loadDefaultModel,toggle:function(){return e.setState({selectModelPage:!1})}}),i.a.createElement(ne,{display:this.state.settingInput,loadDefaultInput:this.loadDefaultInput,loadInput:this.loadCustomInput,toggle:function(){e.setState({settingInput:!1})}}),i.a.createElement(ce,{display:this.state.trainSetup,toggle:function(){return e.setState({trainSetup:!1})},modelInfo:this.state.modelInfo,update:this.updateModelInfo}),i.a.createElement(ee,{errorMsg:this.state.errorMsg,dismissible:this.state.errorOnce,setError:this.setError}),i.a.createElement("div",{className:"container-fluid d-flex h-100 flex-row no-margin"},i.a.createElement(Y,{models:this.state.models,selected:this.state.selected,trainingInfo:this.state.trainingInfo,newModel:this.newModel,setError:this.setError,update:this.updateModel,setSelectModelPage:function(){return e.setState({selectModelPage:!0})},trainCloud:this.trainCloud,cancelTrain:this.cancelTrain,getLink:this.getLink,downloadModel:this.downloadModel,setInput:this.setInput}),i.a.createElement("div",{className:"d-flex w-100 p-2 flex-column flex-grow-1 no-margin",ref:"canvasContainer"},i.a.createElement(V,{models:this.state.models,selected:this.state.selected,select:this.selectModel,update:this.updateModel,remove:this.removeModel,editableSelected:this.state.editableSelected}),i.a.createElement($,{trainSetup:this.trainSetup,modelInfo:this.state.modelInfo,setInputDataset:this.setInput,trainingInfo:this.state.trainingInfo,updateModelInfo:this.updateModelInfo,selected:this.state.selected,models:this.state.models,update:function(t,a,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e.updateParameters(e.state.selected,t,a,n,r)},setEditableSelected:this.setEditableSelected}))))}}]),t}(i.a.Component));a(312),a(313);r.a.render(i.a.createElement(fe,null),document.getElementById("root"))}},[[134,1,2]]]);
//# sourceMappingURL=main.ed6ccf02.chunk.js.map